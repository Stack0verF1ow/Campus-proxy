!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Avalon requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(w,e){var y=new Date-0,$=w.document,a=$.getElementsByTagName("head")[0],C=a.insertBefore(document.createElement("avalon"),a.firstChild);C.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }</style>",C.setAttribute("ms-skip","1"),C.className="avalonHide";var t=/\[native code\]/;function log(){w.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}var g="$"+y,d=!1,h=/[^, ]+/g,v=/^(?:object|array)$/,k=/^\[object SVG\w*Element\]$/,n=/^\[object (?:Window|DOMWindow|global)\]$/,r=Object.prototype,m=r.hasOwnProperty,o=r.toString,b=Array.prototype,x=b.slice,T=w.dispatchEvent,E=$.documentElement,_=$.createDocumentFragment(),p=$.createElement("div"),i={};function noop(){}function oneObject(e,t){"string"==typeof e&&(e=e.match(h)||[]);for(var n={},r=void 0!==t?t:1,a=0,o=e.length;a<o;a++)n[e[a]]=r;return n}"Boolean Number String Function Array Date RegExp Object Error".replace(h,function(e){i["[object "+e+"]"]=e.toLowerCase()});var A=function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,e)};var u=function IE(){if(w.VBArray){var e=document.documentMode;return e||(w.XMLHttpRequest?7:6)}return NaN}();avalon=function(e){return new avalon.init(e)},avalon.profile=function(){w.console&&avalon.config.profile&&Function.apply.call(console.log,console,arguments)},avalon.nextTick=new function(){var e=w.setImmediate,t=w.MutationObserver;if(e)return e.bind(w);var n=[];function callback(){for(var e=n.length,t=0;t<e;t++)n[t]();n=n.slice(e)}if(t){var r=document.createTextNode("avalon");return new t(callback).observe(r,{characterData:!0}),function(e){n.push(e),r.data=Math.random()}}return w.VBArray?function(e){n.push(e);var t=$.createElement("script");t.onreadystatechange=function(){callback(),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}:function(e){setTimeout(e,4)}},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?i[o.call(e)]||"object":typeof e};var l,N="object"==typeof alert?function(e){try{return/^\s*\bfunction\b/.test(e+"")}catch(t){return!1}}:function(e){return"[object Function]"===o.call(e)};function isWindow(e){return n.test(o.call(e))}for(l in avalon.isFunction=N,avalon.isWindow=function(e){return!!e&&(e==e.document&&e.document!=e)},isWindow(w)&&(avalon.isWindow=isWindow),avalon({}))break;var s="0"!==l;function _number(e,t){return(e=Math.floor(e)||0)<0?Math.max(t+e,0):Math.min(e,t)}avalon.isPlainObject=function(e,t){if(!e||"object"!==avalon.type(e)||e.nodeType||avalon.isWindow(e))return!1;try{if(e.constructor&&!m.call(e,"constructor")&&!m.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(s)for(t in e)return m.call(e,t);for(t in e);return void 0===t||m.call(e,t)},t.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return"[object Object]"===o.call(e)&&Object.getPrototypeOf(e)===r}),avalon.mix=avalon.fn.mix=function(){var e,t,n,r,a,o,i=arguments[0]||{},l=1,s=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},l++),"object"==typeof i||N(i)||(i={}),l===s&&(i=this,l--);l<s;l++)if(null!=(e=arguments[l]))for(t in e){n=i[t];try{r=e[t]}catch(u){continue}i!==r&&(c&&r&&(avalon.isPlainObject(r)||(a=Array.isArray(r)))?(a?(a=!1,o=n&&Array.isArray(n)?n:[]):o=n&&avalon.isPlainObject(n)?n:{},i[t]=avalon.mix(c,o,r)):void 0!==r&&(i[t]=r))}return i},avalon.mix({rword:h,subscribers:g,version:1.47,ui:{},log:log,slice:T?function(e,t,n){return x.call(e,t,n)}:function(e,t,n){var r=[],a=e.length;if(void 0===n&&(n=a),"number"==typeof n&&isFinite(n)){t=_number(t,a),n=_number(n,a);for(var o=t;o<n;++o)r[o-t]=e[o]}return r},noop:noop,error:function(e,t){throw(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),null==t&&(t=e||0,e=0);for(var r=-1,a=Math.max(0,Math.ceil((t-e)/n)),o=new Array(a);++r<a;)o[r]=e,e+=n;return o},eventHooks:[],bind:function(t,e,n,r){var a=avalon.eventHooks[e];"object"==typeof a&&(e=a.type||e,r=a.phase||!!r,n=a.fn?a.fn(t,n):n);var o=T?n:function(e){n.call(t,function fixEvent(e){var t={};for(var n in e)t[n]=e[n];var r=t.target=e.srcElement;if(0===e.type.indexOf("key"))t.which=null!=e.charCode?e.charCode:e.keyCode;else if(F.test(e.type)){var a=r.ownerDocument||$,o="BackCompat"===a.compatMode?a.body:a.documentElement;t.pageX=e.clientX+(o.scrollLeft>>0)-(o.clientLeft>>0),t.pageY=e.clientY+(o.scrollTop>>0)-(o.clientTop>>0),t.wheelDeltaY=t.wheelDelta,t.wheelDeltaX=0}return t.timeStamp=new Date-0,t.originalEvent=e,t.preventDefault=function(){e.returnValue=!1},t.stopPropagation=function(){e.cancelBubble=!0},t}(e))};return T?t.addEventListener(e,o,r):t.attachEvent("on"+e,o),o},unbind:function(e,t,n,r){var a=avalon.eventHooks[t],o=n||noop;"object"==typeof a&&(t=a.type||t,r=a.phase||!!r),T?e.removeEventListener(t,o,r):e.detachEvent("on"+t,o)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?camelize(t):t;if(t=avalon.cssName(r)||r,void 0===n||"boolean"==typeof n){"background"===t&&(t="backgroundColor");var a=(Se[r+":get"]||Se["@:get"])(e,t);return!0===n?parseFloat(a)||0:a}if(""===n)e.style[t]="";else{if(null==n||n!=n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),(Se[r+":set"]||Se["@:set"])(e,t,n)}},each:function(e,t){if(e){var n=0;if(function isArrayLike(e){if(!e)return!1;var t=e.length;if(t===t>>>0){var n=o.call(e).slice(8,-1);if(/(?:regexp|string|function|window|global)$/i.test(n))return!1;if("Array"===n)return!0;try{return!1!=={}.propertyIsEnumerable.call(e,"length")||/^\s?function/.test(e.item||e.callee)}catch(r){return!e.window}}return!1}(e))for(var r=e.length;n<r&&!1!==t(n,e[n]);n++);else for(n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))break}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var a in n)0===a.indexOf(t)&&(r[a.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[a]);return r},Array:{ensure:function(e,t){if(-1===e.indexOf(t))return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return!!~n&&avalon.Array.removeAt(e,n)}}});var S=avalon.bindingHandlers={},M=avalon.bindingExecutors={};var c=new function(){function LRU(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var e=LRU.prototype;return e.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n).older=this.tail:this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},e.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key])},e.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),(this.tail=t).value)},LRU};if(!"司徒正美".trim){var f=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(f,"")}}var O=!{toString:null}.propertyIsEnumerable("toString"),j=function(){}.propertyIsEnumerable("prototype"),L=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],D=L.length;function iterator(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function fixContains(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(n){return!1}}function outerHTML(){return(new XMLSerializer).serializeToString(this)}if(Object.keys||(Object.keys=function(e){var t=[],n=j&&"function"==typeof e;if("string"==typeof e||e&&e.callee)for(var r=0;r<e.length;++r)t.push(String(r));else for(var a in e)n&&"prototype"===a||!m.call(e,a)||t.push(String(a));if(O)for(var o=e.constructor,i=o&&o.prototype===e,l=0;l<D;l++){var s=L[l];i&&"constructor"===s||!m.call(e,s)||t.push(s)}return t}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===o.call(e)}),noop.bind||(Function.prototype.bind=function(n){if(arguments.length<2&&void 0===n)return this;var r=this,a=arguments;return function(){var e,t=[];for(e=1;e<a.length;e++)t.push(a[e]);for(e=0;e<arguments.length;e++)t.push(arguments[e]);return r.apply(n,t)}}),t.test([].map)||avalon.mix(b,{indexOf:function(e,t){var n=this.length,r=~~t;for(r<0&&(r+=n);r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=null==t?n-1:t;for(r<0&&(r=Math.max(0,n+r));0<=r;r--)if(this[r]===e)return r;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),avalon.contains=fixContains,$.contains||($.contains=function(e){return fixContains($,e)}),w.SVGElement){$.createTextNode("x").contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))});var P="http://www.w3.org/2000/svg",H=$.createElementNS(P,"svg");if(H.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',!k.test(H.firstChild)){function enumerateNode(e,t){if(e&&e.childNodes)for(var n,r=e.childNodes,a=0;n=r[a++];)if(n.tagName){var o=$.createElementNS(P,n.tagName.toLowerCase());b.forEach.call(n.attributes,function(e){o.setAttribute(e.name,e.value)}),enumerateNode(n,o),t.appendChild(o)}}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if("svg"===t)n.insertBefore(r,this);else{var a=$.createDocumentFragment();enumerateNode(r,a),n.insertBefore(a,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){avalon.clearHTML&&(avalon.clearHTML(this),enumerateNode(avalon.parseHTML(e),this))}}})}}!E.outerHTML&&w.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var F=/^(?:mouse|contextmenu|drag)|click/;var I=avalon.eventHooks;if("onmouseenter"in E||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,e){I[a]={type:e,fn:function(n,r){return function(e){var t=e.relatedTarget;if(!t||t!==n&&!(16&n.compareDocumentPosition(t)))return delete e.type,e.type=a,r.call(n,e)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){w[e]&&!I.animationend&&(I.animationend={type:t})}),"oninput"in $.createElement("input")||(I.input={type:"propertychange",fn:function(t,n){return function(e){if("value"===e.propertyName)return e.type="input",n.call(t,e)}}}),void 0===$.onmousewheel){var B=void 0!==$.onwheel?"wheel":"DOMMouseScroll",V="wheel"===B?"deltaY":"detail";I.mousewheel={type:B,fn:function(t,n){return function(e){e.wheelDeltaY=e.wheelDelta=0<e[V]?-120:120,e.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(e,"type",{value:"mousewheel"}),n.call(t,e)}}}}function kernel(e){for(var t in e)if(m.call(e,t)){var n=e[t];"function"==typeof kernel.plugins[t]?kernel.plugins[t](n):"object"==typeof kernel[t]?avalon.mix(kernel[t],n):kernel[t]=n}return this}var R,G,z,W,U,X=/[-.*+?^${}()|[\]\/\\]/g;function escapeRegExp(e){return(e+"").replace(X,"\\$&")}var Y={interpolate:function(e){if(R=e[0],G=e[1],R===G)throw new SyntaxError("openTag===closeTag");var t=R+"test"+G;if(p.innerHTML=t,p.innerHTML!==t&&-1<p.innerHTML.indexOf("&lt;"))throw new SyntaxError("此定界符不合法");kernel.openTag=R,kernel.closeTag=G,p.innerHTML="";var n=escapeRegExp(R),r=escapeRegExp(G);z=new RegExp(n+"(.*?)"+r),W=new RegExp(n+"(.*?)"+r,"g"),U=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,(kernel.plugins=Y).interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var q=/(\w+)\[(avalonctrl)="(\S+)"\]/,J=$.querySelectorAll?function(e){return $.querySelectorAll(e)}:function(e){for(var t,n=e.match(q),r=$.getElementsByTagName(n[1]),a=[],o=0;t=r[o++];)t.getAttribute(n[2])===n[3]&&a.push(t);return a},Q={$watch:function(e,t){if("function"==typeof t){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(0===n)this.$watch.backup=this.$events,this.$events={};else if(1===n)this.$events[e]=[];else for(var r=this.$events[e]||[],a=r.length;~--a<0;)if(r[a]===t)return r.splice(a,1);return this},$fire:function(e){var n,t,r,a;/^(\w+)!(\S+)$/.test(e)&&(n=RegExp.$1,e=RegExp.$2);var o=this.$events;if(o){var i=x.call(arguments,1),l=[e].concat(i);if("all"===n)for(t in avalon.vmodels)(r=avalon.vmodels[t])!==this&&r.$fire.apply(r,l);else if("up"===n||"down"===n){var s=o.expr?J(o.expr):[];if(0===s.length)return;for(t in avalon.vmodels)if((r=avalon.vmodels[t])!==this&&r.$events.expr){var c=J(r.$events.expr);if(0===c.length)continue;b.forEach.call(c,function(t){b.forEach.call(s,function(e){("down"===n?e.contains(t):t.contains(e))&&(t._avalon=r)})})}var u=$.getElementsByTagName("*"),f=[];for(b.forEach.call(u,function(e){e._avalon&&(f.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),"up"===n&&f.reverse(),t=0;(a=f[t++])&&!1!==a.$fire.apply(a,l););}else{var p=o[e]||[],d=o.$all||[];for(t=0;a=p[t++];)N(a)&&a.apply(this,i);for(t=0;a=d[t++];)N(a)&&a.apply(this,arguments)}}}},Z=avalon.vmodels={};avalon.define=function(e,t){var n=e.$id||e;if(n||log("warning: vm必须指定$id"),Z[n]&&log("warning: "+n+" 已经存在于avalon.vmodels中"),"object"==typeof e)var r=modelFactory(e);else{var a={$watch:noop};t(a),r=modelFactory(a),d=!0,t(r),d=!1}return r.$id=n,Z[n]=r};var K=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$reinitialize").match(h),ee=Object.defineProperty,te=!0;try{ee({},"_",{value:"x"});var ne=Object.defineProperties}catch(tn){te=!1}function modelFactory(a,e,o){if(Array.isArray(a)){var t=a.concat();a.length=0;var n=function arrayFactory(e){var n=[];for(var t in n.$id=A(),n.$model=e,n.$events={},n.$events[g]=[],n._=modelFactory({length:e.length}),n._.$watch("length",function(e,t){n.$fire("length",e,t)}),Q)n[t]=Q[t];return avalon.mix(n,le),n}(a);return n.pushArray(t),n}if(!a||0<a.nodeType||a.$id&&a.$events)return a;var i=Array.isArray(a.$skipArray)?a.$skipArray:[];i.$special=e||{};var l={};o=o||{};var s={},c={},u=[];K.forEach(function(e){delete a[e]});var r=Object.keys(a);r.forEach(function(e,t){var n=a[e];if(function isObservable(e,t,n){if(N(t)||t&&t.nodeType)return!1;if(-1!==n.indexOf(e))return!1;var r=n.$special;if(e&&"$"===e.charAt(0)&&!r[e])return!1;return!0}(e,o[e]=n,i)){s[e]=[];var r=avalon.type(n);"object"===r&&N(n.get)&&Object.keys(n).length<=2?(t=function makeComputedAccessor(o,e){function accessor(e){var t=accessor._value,n="_value"in accessor;if(0<arguments.length){if(d)return this;if("function"==typeof accessor.set&&accessor.oldArgs!==e){accessor.oldArgs=e;var r=this.$events,a=r[o];r[o]=[],accessor.set.call(this,e),r[o]=a,(e=accessor.get.call(this))!==t&&(accessor.updateValue(this,e),accessor.notify(this,e,t))}return this}return e=accessor.get.call(this),accessor.updateValue(this,e),n&&t!==e&&accessor.notify(this,e,t),e}return accessor.set=e.set,accessor.get=e.get,accessorFactory(accessor,o),accessor}(e,n),u.push(t)):t=v.test(r)?function makeComplexAccessor(f,e,p,t,n){function accessor(e){var t=accessor._value,n=accessor._vmodel;if(0<arguments.length){if(d)return this;if("array"===p){var r=n,a=e,o=r.length,i=a.length;r.$lock=!0,i<o?r.splice(i,o-i):o<i&&r.push.apply(r,a.slice(o));for(var l=Math.min(o,i),s=0;s<l;s++)r.set(s,a[s]);delete r.$lock,r._fire("set")}else if("object"===p){var c=this.$events[f]||[],u=avalon.mix(!0,{},e);for(s in n)n.hasOwnProperty(s)&&m.call(u,s)&&(n[s]=u[s]);((n=accessor._vmodel=modelFactory(e)).$events[g]=c).length&&c.forEach(function(e){e.type&&(e.rollback&&e.rollback(),S[e.type](e,e.vmodels))})}return accessor.updateValue(this,n.$model),accessor.notify(this,this._value,t),this}return ue.collectDependency(this,accessor),n}accessorFactory(accessor,f),Array.isArray(e)?n[f]=e:n[f]=n[f]||{};return(accessor._vmodel=modelFactory(e,0,n[f])).$events[g]=t,accessor}(e,n,r,s[e],o):function makeSimpleAccessor(e,t){function accessor(e){var t=accessor._value;return 0<arguments.length?(d||re(e,t)||(accessor.updateValue(this,e),accessor.notify(this,e,t)),this):(ue.collectDependency(this,accessor),t)}return accessorFactory(accessor,e),accessor._value=t,accessor}(e,n),c[e]=t}}),l=ne(l,ae(c),a);for(var f=0;f<r.length;f++){var p=r[f];c[p]||(l[p]=a[p])}for(f in hideProperty(l,"$id",A()),hideProperty(l,"$model",o),hideProperty(l,"$events",s),te?hideProperty(l,"hasOwnProperty",function(e){return e in l.$model}):l.hasOwnProperty=function(e){return e in l.$model&&"hasOwnProperty"!==e},Q)hideProperty(l,f,Q[f].bind(l));return l.$reinitialize=function(){u.forEach(function(r){delete r._value,delete r.oldArgs,r.digest=function(){r.call(l)},ue.begin({callback:function(e,t){var n=t._name;t!==r&&injectDependency(e.$events[n],r.digest)}});try{r.get.call(l)}finally{ue.end()}})},l.$reinitialize(),l}function hideProperty(e,t,n){te?Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0}):e[t]=n}function globalUpdateValue(e,t){e.$model[this._name]=this._value=t}function globalNotify(e,t,n){var r=this._name,a=e.$events[r];a&&(fireDependencies(a),Q.$fire.call(e,r,t,n))}function accessorFactory(e,t){e._name=t,e.updateValue=globalUpdateValue,e.notify=globalNotify}var re=Object.is||function(e,t){return 0===e&&0===t?1/e==1/t:e!=e?t!=t:e===t};function keysVM(e){for(var t=Object.keys(e.$model?e.$model:e),n=0;n<K.length;n++){var r=t.indexOf(K[n]);-1!==r&&t.splice(r,1)}return t}var ae=T?function(e){var t={};for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t}:function(e){return e};if(!te&&("__defineGetter__"in avalon&&(ee=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},ne=function(e,t){for(var n in t)t.hasOwnProperty(n)&&ee(e,n,t[n]);return e}),u)){var oe={};function VBMediator(e,t,n,r){var a=t[n];if(4!==arguments.length)return a.call(e);a.call(e,r)}w.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function"].join("\n"),"VBScript"),ne=function(e,t,n){var r=[];for(e in r.push("\r\n\tPrivate [__data__], [__proxy__]","\tPublic Default Function [__const__](d"+y+", p"+y+")","\t\tSet [__data__] = d"+y+": set [__proxy__] = p"+y,"\t\tSet [__const__] = Me","\tEnd Function"),n)t.hasOwnProperty(e)||r.push("\tPublic ["+e+"]");for(e in K.forEach(function(e){t.hasOwnProperty(e)||r.push("\tPublic ["+e+"]")}),r.push("\tPublic [hasOwnProperty]"),t)r.push("\tPublic Property Let ["+e+"](val"+y+")",'\t\tCall [__proxy__](Me,[__data__], "'+e+'", val'+y+")","\tEnd Property","\tPublic Property Set ["+e+"](val"+y+")",'\t\tCall [__proxy__](Me,[__data__], "'+e+'", val'+y+")","\tEnd Property","\tPublic Property Get ["+e+"]","\tOn Error Resume Next","\t\tSet["+e+'] = [__proxy__](Me,[__data__],"'+e+'")',"\tIf Err.Number <> 0 Then","\t\t["+e+'] = [__proxy__](Me,[__data__],"'+e+'")',"\tEnd If","\tOn Error Goto 0","\tEnd Property");r.push("End Class");var a=r.join("\r\n"),o=oe[a];return o||(o=A("VBClass"),w.parseVB("Class "+o+a),w.parseVB(["Function "+o+"Factory(a, b)","\tDim o","\tSet o = (New "+o+")(a, b)","\tSet "+o+"Factory = o","End Function"].join("\r\n")),oe[a]=o),w[o+"Factory"](t,VBMediator)}}function mutateArray(e,t,n,r,a,o,i){for(var l=this.length,s=2;--s;){switch(e){case"add":var c=this.$model.slice(t,t+n).map(function(e){return v.test(avalon.type(e))?e.$id?e:modelFactory(e,0,e):e});ie.apply(this,[t,0].concat(c)),this._fire("add",t,n);break;case"del":var u=this._splice(t,n);this._fire("del",t,n)}a&&(e=a,t=o,n=i,s=2,a=0)}return this._fire("index",r),this.length!==l&&(this._.length=this.length),u}var ie=b.splice,le={_splice:ie,_fire:function(e,t,n){fireDependencies(this.$events[g],e,t,n)},size:function(){return this._.length},pushArray:function(e){var t=e.length,n=this.length;return t&&(b.push.apply(this.$model,e),mutateArray.call(this,"add",n,t,Math.max(0,n-1))),t+n},push:function(){var e,t=[],n=arguments.length;for(e=0;e<n;e++)t[e]=arguments[e];return this.pushArray(t)},unshift:function(){var e=arguments.length,t=this.length;return e&&(b.unshift.apply(this.$model,arguments),mutateArray.call(this,"add",0,e,0)),e+t},shift:function(){if(this.length){var e=this.$model.shift();return mutateArray.call(this,"del",0,1,0),e}},pop:function(){var e=this.length;if(e){var t=this.$model.pop();return mutateArray.call(this,"del",e-1,1,Math.max(0,e-2)),t}},splice:function(e){var t,n=arguments.length,r=[],a=ie.apply(this.$model,arguments);return a.length&&(r.push("del",e,a.length,0),t=!0),2<n&&(t?r.splice(3,1,0,"add",e,n-2):r.push("add",e,n-2,0),t=!0),t?mutateArray.apply(this,r):[]},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return 0<=e?(this.$model.splice(e,1),mutateArray.call(this,"del",e,1,0)):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))for(var t=this.length-1;0<=t;t--)-1!==e.indexOf(this[t])&&this.removeAt(t);else if("function"==typeof e)for(t=this.length-1;0<=t;t--){e(this[t],t)&&this.removeAt(t)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e<this.length&&-1<e){var n=avalon.type(t);t&&t.$model&&(t=t.$model);var r=this[e];if("object"===n)for(var a in t)r.hasOwnProperty(a)&&(r[a]=t[a]);else"array"===n?r.clear().push.apply(r,t):r!==t&&(this[e]=t,this.$model[e]=t,this._fire("set",e,t))}return this}};function sortByIndex(e,t){for(var n={},r=0,a=t.length;r<a;r++){n[r]=e[r];var o=t[r];o in n?(e[r]=n[o],delete n[o]):e[r]=e[o]}}"sort,reverse".replace(h,function(u){le[u]=function(){var e,t=this.$model,n=t.concat(),r=Math.random(),a=[];b[u].apply(t,arguments);for(var o=0,i=n.length;o<i;o++){var l=t[o],s=n[o];if(re(l,s))a.push(o);else{var c=n.indexOf(l);a.push(c),n[c]=r,e=!0}}return e&&(sortByIndex(this,a),this._fire("move",a),this._fire("index",0)),this}});var se,ce,ue=(ce=[],{begin:function(e){ce.push(se),se=e},end:function(){se=ce.pop()},collectDependency:function(e,t){se&&se.callback(e,t)}}),fe=/^(duplex|on)$/;function injectDependency(e,t){t.oneTime||e&&avalon.Array.ensure(e,t)&&t.element&&(injectDisposeQueue(t,e),444<new Date-ve&&rejectDisposeQueue())}function fireDependencies(e){if(e&&e.length){444<new Date-ve&&"object"==typeof e[0]&&rejectDisposeQueue();for(var t,n=x.call(arguments,1),r=e.length;t=e[--r];){var a=t.element;if(a&&a.parentNode)try{var o=t.evaluator;if(t.$repeat)t.handler.apply(t,n);else if("$repeat"in t||!o)S[t.type](t,t.vmodels);else if("on"!==t.type){var i=o.apply(0,t.args||[]);t.handler(i,a,t)}}catch(tn){console.log(tn)}}}}avalon.injectBinding=function(n){var e=n.evaluator;if(e){ue.begin({callback:function(e,t){injectDependency(e.$events[t._name],n)}});try{var t=fe.test(n.type)?n:e.apply(0,n.args);void 0===t&&delete n.evaluator,n.handler(t,n.element,n)}catch(tn){log("warning:exception throwed in [avalon.injectBinding] ",tn),delete n.evaluator;var r=n.element;if(3===r.nodeType){var a=r.parentNode;kernel.commentInterpolate?a.replaceChild($.createComment(n.value),r):r.data=R+(n.oneTime?"::":"")+n.value+G}}finally{ue.end()}}};var pe=0,de=avalon.$$subscribers=[],ve=new Date,he={};function getUid(e,t){return e.uuid||t||(e.uuid=++pe),e.uuid}function injectDisposeQueue(e,t){var n=e.element;e.uuid||(1!==n.nodeType?e.uuid=e.type+getUid(n.parentNode)+"-"+ ++pe:e.uuid=e.name+"-"+getUid(n));var r=e.lists||(e.lists=[]);avalon.Array.ensure(r,t),t.$uuid=t.$uuid||A(),de[e.uuid]||(de[e.uuid]=1,de.push(e))}function rejectDisposeQueue(e){if(!avalon.optimize){for(var t=de.length,n=t,r=[],a={},o={};e=de[--t];){var i=e.type;o[i]?o[i]++:(o[i]=1,r.push(i))}var l=!1;if(r.forEach(function(e){he[e]!==o[e]&&(a[e]=1,l=!0)}),t=n,l)for(;e=de[--t];)if(null!==e.element){if(a[e.type]&&shouldDispose(e.element)){de.splice(t,1),delete de[e.uuid];for(var s,c=e.lists,u=0;s=c[u++];)avalon.Array.remove(c,s),avalon.Array.remove(s,e);disposeData(e)}}else de.splice(t,1);he=o,ve=new Date}}function disposeData(e){for(var t in delete de[e.uuid],e.element=null,e.rollback&&e.rollback(),e)e[t]=null}function shouldDispose(e){try{e.parentNode.nodeType}catch(tn){return!0}return e.ifRemove&&!E.contains(e.ifRemove)&&C===e.parentNode?(e.parentNode&&e.parentNode.removeChild(e),!0):e.msRetain?0:1===e.nodeType?!E.contains(e):!avalon.contains(E,e)}var me={area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],col:[2,"<table><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table>","</table>"],td:[3,"<table><tr>","</tr></table>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"</svg>"],_default:T?[0,"",""]:[1,"X<div>","</div>"]};me.th=me.td,me.optgroup=me.option,me.tbody=me.tfoot=me.colgroup=me.caption=me.thead,String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(h,function(e){me[e]=me.g});var ye=/<([\w:]+)/,ge=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,be=T?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/gi,xe=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),we=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,$e=$.createElement("script"),Ce=/<|&#?\w+;/;function isVML(e){var t=e.nodeName;return t.toLowerCase()===t&&e.scopeName&&""===e.outerText}function fixVML(e){"url(#default#VML)"!==e.currentStyle.behavior&&(e.style.behavior="url(#default#VML)",e.style.display="inline-block",e.style.zoom=1)}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}avalon.parseHTML=function(e){var t=_.cloneNode(!1);if("string"!=typeof e)return t;if(!Ce.test(e))return t.appendChild($.createTextNode(e)),t;e=e.replace(ge,"<$1></$2>").trim();var n,r,a=(ye.exec(e)||["",""])[1].toLowerCase(),o=me[a]||me._default,i=p;T||(e=e.replace(be,"<br class=msNoScope>$1")),i.innerHTML=o[1]+e+o[2];var l=i.getElementsByTagName("script");if(l.length)for(var s,c=0;s=l[c++];)xe[s.type]&&(r=$e.cloneNode(!1),b.forEach.call(s.attributes,function(e){e&&e.specified&&(r[e.name]=e.value,r.setAttribute(e.name,e.value))}),r.text=s.text,s.parentNode.replaceChild(r,s));if(!T){var u="X<div>"===o[1]?i.lastChild.firstChild:i.lastChild;if(u&&"TABLE"===u.tagName&&"tbody"!==a)for(l=u.childNodes,c=0;s=l[c++];)if("TBODY"===s.tagName&&!s.innerHTML){u.removeChild(s);break}for(var f=(l=i.getElementsByTagName("br")).length;s=l[--f];)"msNoScope"===s.className&&s.parentNode.removeChild(s);for(l=i.all,c=0;s=l[c++];)isVML(s)&&fixVML(s)}for(c=o[0];c--;i=i.lastChild);for(;n=i.firstChild;)t.appendChild(n);return t},avalon.innerHTML=function(e,t){if(!T&&!be.test(t)&&!we.test(t))try{return void(e.innerHTML=t)}catch(tn){}var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},avalon.clearHTML=function(e){for(e.textContent="";e.firstChild;)e.removeChild(e.firstChild);return e};var ke={_toString:function(){var e=this.node.className;return("string"==typeof e?e:e.baseVal).split(/\s+/).join(" ")},_contains:function(e){return-1<(" "+this+" ").indexOf(" "+e+" ")},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;k.test(t)?t.setAttribute("class",e):t.className=e}};function fakeClassList(e){if(!("classList"in e))for(var t in e.classList={node:e},ke)e.classList[t.slice(1)]=ke[t];return e.classList}function parseData(e){try{if("object"==typeof e)return e;e="true"===e||"false"!==e&&("null"===e?null:+e+""===e?+e:Te.test(e)?avalon.parseJSON(e):e)}catch(tn){}return e}"add,remove".replace(h,function(n){avalon.fn[n+"Class"]=function(e){var t=this[0];return e&&"string"==typeof e&&t&&1===t.nodeType&&e.replace(/\S+/g,function(e){fakeClassList(t)[n](e)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&fakeClassList(t).contains(e)},toggleClass:function(e,t){for(var n,r=0,a=String(e).split(/\s+/),o="boolean"==typeof t;n=a[r++];){var i=o?t:!this.hasClass(n);this[i?"addClass":"removeClass"](n)}return this},attr:function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(t,e){switch(t="data-"+hyphen(t||""),arguments.length){case 2:return this.attr(t,e),this;case 1:return parseData(this.attr(t));case 0:var n={};return b.forEach.call(this[0].attributes,function(e){e&&((t=e.name).indexOf("data-")||(t=camelize(t.slice(5)),n[t]=parseData(e.value)))}),n}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return void 0!==r?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(n)return"fixed"===this.css("position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),"HTML"!==e[0].tagName&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0),r.top-=e.scrollTop(),r.left-=e.scrollLeft()),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){for(var e=this[0].offsetParent;e&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||E)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&1===t.nodeType){var n=0===arguments.length,r=n?":get":":set",a=Ve[function getValType(e){var t=e.tagName.toLowerCase();return"input"===t&&/checkbox|radio/.test(e.type)?"checked":t}(t)+r];if(a)var o=a(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?o:this}});var Te=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Ee=/^[\],:{}\s]*$/,Ae=/(?:^|:|,)(?:\s*\[)+/g,Ne=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,_e=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=w.JSON?JSON.parse:function(e){if("string"==typeof e){if((e=e.trim())&&Ee.test(e.replace(Ne,"@").replace(_e,"]").replace(Ae,"")))return new Function("return "+e)();avalon.error("Invalid JSON: "+e)}return e},avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,o){avalon.fn[a]=function(e){var t=this[0]||{},n=function getWindow(e){return e.window&&e.document?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}(t),r="scrollTop"===a;if(!arguments.length)return n?o in n?n[o]:E[a]:t[a];n?n.scrollTo(r?avalon(n).scrollLeft():e,r?e:avalon(n).scrollTop()):t[a]=e}});var Se=avalon.cssHooks={},Me=["","-webkit-","-o-","-moz-","-ms-"],Oe={"float":T?"cssFloat":"styleFloat"};if(avalon.cssNumber=oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(Oe[e])return Oe[e];t=t||E.style;for(var r=0,a=Me.length;r<a;r++)if((n=camelize(Me[r]+e))in t)return Oe[e]=n;return null},Se["@:set"]=function(e,t,n){try{e.style[t]=n}catch(tn){}},w.getComputedStyle)Se["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&""===(n="filter"===t?r.getPropertyValue(t):r[t])&&(n=e.style[t]),n},Se["opacity:get"]=function(e){var t=Se["@:get"](e,"opacity");return""===t?"1":t};else{var je=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,Le=/^(top|right|bottom|left)$/,De=/alpha\([^)]*\)/i,Pe=!!w.XDomainRequest,He={thin:Pe?"1px":"2px",medium:Pe?"3px":"4px",thick:Pe?"5px":"6px"};Se["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(je.test(r)&&!Le.test(r)){var a=e.style,o=a.left,i=e.runtimeStyle.left;e.runtimeStyle.left=n.left,a.left="fontSize"===t?"1em":r||0,r=a.pixelLeft+"px",a.left=o,e.runtimeStyle.left=i}return"medium"===r&&"none"===n[t=t.replace("Width","Style")]&&(r="0px"),""===r?"auto":He[r]||r},Se["opacity:set"]=function(e,t,n){var r=e.style,a=isFinite(n)&&n<=1?"alpha(opacity="+100*n+")":"",o=r.filter||"";r.zoom=1,r.filter=(De.test(o)?o.replace(De,a):o+" "+a).trim(),r.filter||r.removeAttribute("filter")},Se["opacity:get"]=function(e){var t=e.filters.alpha||e.filters["DXImageTransform.Microsoft.Alpha"];return(t&&t.enabled?t.opacity:100)/100+""}}"top,left".replace(h,function(n){Se[n+":get"]=function(e){var t=Se["@:get"](e,n);return/px$/.test(t)?t:avalon(e).position()[n]+"px"}});var Fe={position:"absolute",visibility:"hidden",display:"block"},Ie=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(h,function(o){var i=o.toLowerCase(),r="client"+o,a="scroll"+o,l="offset"+o;Se[i+":get"]=function(e,t,n){var r=-4;"number"==typeof n&&(r=n),t="Width"===o?["Left","Right"]:["Top","Bottom"];var a=e[l];return 2===r?a+avalon.css(e,"margin"+t[0],!0)+avalon.css(e,"margin"+t[1],!0):(r<0&&(a=a-avalon.css(e,"border"+t[0]+"Width",!0)-avalon.css(e,"border"+t[1]+"Width",!0)),-4===r&&(a=a-avalon.css(e,"padding"+t[0],!0)-avalon.css(e,"padding"+t[1],!0)),a)},Se[i+"&get"]=function(e){var t=[];!function showHidden(e,t){if(e.offsetWidth<=0){if(Ie.test(Se["@:get"](e,"display"))){var n={node:e};for(var r in Fe)n[r]=e.style[r],e.style[r]=Fe[r];t.push(n)}var a=e.parentNode;a&&1===a.nodeType&&showHidden(a,t)}}(e,t);for(var n,r=Se[i+":get"](e),a=0;n=t[a++];)for(var o in e=n.node,n)"string"==typeof n[o]&&(e.style[o]=n[o]);return r},avalon.fn[i]=function(e){var t=this[0];if(0===arguments.length){if(t.setTimeout)return t["inner"+o]||t.document.documentElement[r]||t.document.body[r];if(9===t.nodeType){var n=t.documentElement;return Math.max(t.body[a],n[a],t.body[l],n[l],n[r])}return Se[i+"&get"](t)}return this.css(i,e)},avalon.fn["inner"+o]=function(){return Se[i+":get"](this[0],void 0,-2)},avalon.fn["outer"+o]=function(e){return Se[i+":get"](this[0],void 0,!0===e?2:0)}}),avalon.fn.offset=function(){var e=this[0],t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,r=n.body,a=n.documentElement,o=n.defaultView||n.parentWindow;if(!avalon.contains(a,e))return t;e.getBoundingClientRect&&(t=e.getBoundingClientRect());var i=a.clientTop||r.clientTop,l=a.clientLeft||r.clientLeft,s=Math.max(o.pageYOffset||0,a.scrollTop,r.scrollTop),c=Math.max(o.pageXOffset||0,a.scrollLeft,r.scrollLeft);return{top:t.top+s-i,left:t.left+c-l}};var Be=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,Ve={"option:get":u?function(e){return Be.test(e.outerHTML)?e.value:e.text.trim()}:function(e){return e.value},"select:get":function(e,t){for(var n,r=e.options,a=e.selectedIndex,o=Ve["option:get"],i="select-one"===e.type||a<0,l=i?null:[],s=i?a+1:r.length,c=a<0?s:i?a:0;c<s;c++)if(((n=r[c]).selected||c===a)&&!n.disabled){if(t=o(n),i)return t;l.push(t)}return l},"select:set":function(e,t,n){t=[].concat(t);for(var r,a=Ve["option:get"],o=0;r=e.options[o++];)(r.selected=-1<t.indexOf(a(r)))&&(n=!0);n||(e.selectedIndex=-1)}},Re={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},Ge=w.JSON&&JSON.stringify||function(e){return'"'+e.replace(/[\\\"\x00-\x1f]/g,function(e){var t=Re[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'},ze=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),We=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,Ue=/[^\w$]+/g,Xe=new RegExp(["\\b"+ze.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),Ye=/\b\d[^,]*/g,qe=/^,+|,+$/g,Je=new c(512),Qe=function(e){var t=","+e.trim(),n=Je.get(t);if(n)return n;var r=e.replace(We,"").replace(Ue,",").replace(Xe,"").replace(Ye,"").replace(qe,"").split(/^$|,+/);return Je.put(t,uniqSet(r))};function addAssign(e,t,n,r){for(var a,o=[],i=" = "+n+".",l=e.length;a=e[--l];)t.hasOwnProperty(a)&&(o.push(a+i+a),r.vars.push(a),"duplex"===r.type&&(e.get=n+"."+a),e.splice(l,1));return o}function uniqSet(e){for(var t=[],n={},r=0;r<e.length;r++){var a=e[r],o=a&&"string"==typeof a.$id?a.$id:a;n[o]||(n[o]=t.push(a))}return t}var Ze=new c(128),Ke=/\w\[.*\]|\w\.\w/,et=/(\$proxy\$[a-z]+)\d+$/,tt=/\)\s*$/,nt=/\)\s*\|/g,rt=/\|\s*([$\w]+)/g,at=/"\s*\["/g,ot=/"\s*\(/g;function parseExpr(c,e,t){var n=t.type,r=t.filters||"",a=e.map(function(e){return String(e.$id).replace(et,"$1")})+c+n+r,o=Qe(c).concat(),u=[],i=[],l=[],s="";e=uniqSet(e),t.vars=[];for(var f=0,p=e.length;f<p;f++)if(o.length){var d="vm"+y+"_"+f;i.push(d),l.push(e[f]),u.push.apply(u,addAssign(o,e[f],d,t))}if(u.length||"duplex"!==n){"duplex"!==n&&(-1<c.indexOf("||")||-1<c.indexOf("&&"))&&t.vars.forEach(function(s){var e=new RegExp("\\b"+s+"(?:\\.\\w+|\\[\\w+\\])+","ig");c=c.replace(e,function(e,t){var n=e.charAt(s.length),r=c.slice(t+e.length),a=/^\s*\(/.test(r);if("."===n||"["===n||a){var o="var"+String(Math.random()).replace(/^0\./,"");if(a){var i=e.split(".");if(2<i.length){var l=i.pop();return u.push(o+" = "+i.join(".")),o+"."+l}return e}return u.push(o+" = "+e),o}return e})}),t.args=l,delete t.vars;var v=Ze.get(a);if(v)t.evaluator=v;else if((s=u.join(", "))&&(s="var "+s),/\S/.test(r)){if(!/text|html/.test(t.type))throw Error("ms-"+t.type+"不支持过滤器");c="\nvar ret"+y+" = "+c+";\r\n",c+=function parseFilter(e,t){return"return this.filters.$filter("+e+", "+(t=t.replace(tt,"").replace(nt,function(){return"],|"}).replace(rt,function(e,t){return"["+Ge(t)}).replace(at,function(){return'"],["'}).replace(ot,function(){return'",'})+"]")+")"}("ret"+y,r);try{v=Function.apply(noop,i.concat("'use strict';\n"+s+c)),t.evaluator=Ze.put(a,function(){return v.apply(avalon,arguments)})}catch(tn){log("debug: parse error,"+tn.message)}o=u=i=null}else if("duplex"!==n){if("on"===n){-1===c.indexOf("(")?c+=".call(this, $event)":c=c.replace("(",".call(this,"),i.push("$event");var h=(c="\nreturn "+c+";").lastIndexOf("\nreturn");c=c.slice(0,h)+"\n"+c.slice(h)}else c="\nreturn "+c+";";try{v=Function.apply(noop,i.concat("'use strict';\n"+s+c)),t.evaluator=Ze.put(a,v)}catch(tn){log("debug: parse error,"+tn.message)}o=u=i=null}else{var m="'use strict';\nreturn function(vvv){\n\t"+s+";\n\tif(!arguments.length){\n\t\treturn "+c+"\n\t}\n\t"+(Ke.test(c)?c:o.get)+"= vvv;\n} ";try{v=Function.apply(noop,i.concat(m)),t.evaluator=Ze.put(a,v)}catch(tn){log("debug: parse error,"+tn.message)}o=u=i=null}}}function stringifyExpr(e){if(z.test(e)){var t=scanExpr(e);return 1===t.length?t[0].value:t.map(function(e){return e.expr?"("+e.value+")":Ge(e.value)}).join(" + ")}return e}function parseExprProxy(e,t,n,r){parseExpr(e=e||"",t,n),n.evaluator&&!r&&(n.handler=M[n.handlerName||n.type],avalon.injectBinding(n))}avalon.parseExprProxy=parseExprProxy,avalon.scan=function(e,t){scanTag(e=e||E,t?[].concat(t):[])};var it=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase());function createSignalTower(e,t){var n=e.getAttribute("avalonctrl")||t.$id;e.setAttribute("avalonctrl",n),t.$events.expr=e.tagName+'[avalonctrl="'+n+'"]'}var lt=function(e,t,n){var r=e.getAttribute(t);if(r)for(var a,o=0;a=n[o++];)if(a.hasOwnProperty(r)&&"function"==typeof a[r])return a[r]};function executeBindings(e,t){for(var n,r=0;n=e[r++];)n.vmodels=t,S[n.type](n,t),n.evaluator&&n.element&&1===n.element.nodeType&&n.element.removeAttribute(n.name);e.length=0}var st=u&&w.MutationObserver?function(e){for(var t,n=e.firstChild;n;){var r=n.nextSibling;3===n.nodeType?t?(t.nodeValue+=n.nodeValue,e.removeChild(n)):t=n:t=null,n=r}}:0,ct=/^\s*::/,ut=/ms-(\w+)-?(.*)/,ft={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},pt=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),dt=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled");function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(t,e,n){var r=!0;if(e.length){for(var a,o=wt?wt(t):t.attributes,i=[],l=[],s={},c={},u=0;a=o[u++];)if(a.specified&&(n=a.name.match(ut))){var f=n[1],p=n[2]||"",d=a.value,v=a.name;if(c[v])continue;if(c[v]=1,pt[f]?(p=f,f="on"):dt[f]&&("enabled"===f&&(log("warning!ms-enabled或ms-attr-enabled已经被废弃"),f="disabled",d="!("+d+")"),p=f,v="ms-"+(f="attr")+"-"+p,l.push([a.name,v,d])),s[v]=d,"function"==typeof S[f]){var h=d.replace(ct,""),m={type:f,param:p,element:t,name:v,value:h,oneTime:d!==h,uuid:v+"-"+getUid(t),priority:(ft[f]||10*f.charCodeAt(0))+(Number(p.replace(/\D/g,""))||0)};if("html"===f||"text"===f){var y=getToken(d);avalon.mix(m,y),m.filters=m.filters.replace($t,function(){return m.type="html",m.group=1,""})}else if("duplex"===f)var g=v;else"ms-if-loop"===v&&(m.priority+=100);i.push(m),"widget"===f&&(t.msData=t.msData||s)}}if(i.length){for(i.sort(bindingSorter),l.forEach(function(e){log("warning!请改用"+e[1]+"代替"+e[0]+"!"),t.removeAttribute(e[0]),t.setAttribute(e[1],e[2])}),g&&s["ms-attr-value"]&&!t.scopeName&&"text"===t.type&&log("warning!一个控件不能同时定义ms-attr-value与"+g),u=0;m=i[u];u++){if(f=m.type,vt.test(f))return executeBindings(i.slice(0,u+1),e);r&&(r=!ht.test(f))}executeBindings(i,e)}}r&&!it[t.tagName]&&U.test(t.innerHTML.replace(kt,"<").replace(Tt,">"))&&(st&&st(t),function scanNodeList(e,t){scanNodeArray(avalon.slice(e.childNodes),t)}(t,e))}var vt=/^if|widget|repeat$/,ht=/^each|with|html|include$/;if(!T)var mt=new c(512),yt=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,gt=/^['"]/,bt=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,xt=/&amp;/g,wt=function(e){var t=e.outerHTML;if("</"===t.slice(0,2)||!t.trim())return[];var n,r,a=t.match(bt)[0],o=[],i=mt.get(a);if(i)return i;for(;n=yt.exec(a);){(r=n[2])&&(r=(gt.test(r)?r.slice(1,-1):r).replace(xt,"&"));var l=n[1].toLowerCase();l.match(ut);var s={name:l,specified:!0,value:r||""};o.push(s)}return mt.put(a,o)};function scanNodeArray(e,t){for(var n,r=0;n=e[r++];)switch(n.nodeType){case 1:scanTag(n,t),n.msCallback&&(n.msCallback(),n.msCallback=void 0);break;case 3:z.test(n.nodeValue)&&scanText(n,t)}}function scanTag(e,t,n){var r=e.getAttribute("ms-skip");if(!e.getAttributeNode)return log("warning "+e.tagName+" no getAttributeNode method");var a=e.getAttributeNode("ms-important"),o=e.getAttributeNode("ms-controller");if("string"!=typeof r){if(n=a||o){var i=avalon.vmodels[n.value];if(!i)return;t=n===a?[i]:[i].concat(t);var l=n.name;e.removeAttribute(l),avalon(e).removeClass(l),createSignalTower(e,i)}scanAttr(e,t)}}var $t=/\|\s*html(?:\b|$)/,Ct=/\|\|/g,kt=/&lt;/g,Tt=/&gt;/g,Et=/(['"])(\\\1|.)+?\1/g;function getToken(e){if(0<e.indexOf("|")){var t=e.replace(Et,function(e){return Array(e.length+1).join("1")}).replace(Ct,"ᄢ㍄").indexOf("|");if(-1<t)return{filters:e.slice(t),value:e.slice(0,t),expr:!0}}return{value:e,filters:"",expr:!0}}function scanExpr(e){for(var t,n,r=[],a=0;;){if(-1===(n=e.indexOf(R,a)))break;if((t=e.slice(a,n))&&r.push({value:t,filters:"",expr:!1}),a=n+R.length,-1===(n=e.indexOf(G,a)))break;(t=e.slice(a,n))&&r.push(getToken(t)),a=n+G.length}return(t=e.slice(a))&&r.push({value:t,expr:!1,filters:""}),r}function scanText(e,t){var n=[],r=scanExpr(e.data);if(r.length){for(var a,o=0;a=r[o++];){var i=$.createTextNode(a.value);a.expr&&(a.value=a.value.replace(ct,function(){return a.oneTime=!0,""}),a.type="text",a.element=i,a.filters=a.filters.replace($t,function(e,t,n){return a.type="html",""}),n.push(a)),_.appendChild(i)}e.parentNode.replaceChild(_,e),n.length&&executeBindings(n,t)}}var At=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),Nt={};At.replace(h,function(e){Nt[e.toLowerCase()]=e});var _t={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"};["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",").replace(h,function(e){_t[e.toLowerCase()]=e});var St=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,Mt=/<noscript.*?>([\s\S]+?)<\/noscript>/im,Ot=function(){return new(w.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},jt=avalon.templateCache={};S.attr=function(e,t){var n=stringifyExpr(e.value.trim());if("include"===e.type){var r=e.element;e.includeRendered=lt(r,"data-include-rendered",t),e.includeLoaded=lt(r,"data-include-loaded",t);var a=e.includeReplace=!!avalon(r).data("includeReplace");avalon(r).data("includeCache")&&(e.templateCache={}),e.startInclude=$.createComment("ms-include"),e.endInclude=$.createComment("ms-include-end"),a?(e.element=e.startInclude,r.parentNode.insertBefore(e.startInclude,r),r.parentNode.insertBefore(e.endInclude,r.nextSibling)):(r.insertBefore(e.startInclude,r.firstChild),r.appendChild(e.endInclude))}e.handlerName="attr",parseExprProxy(n,t,e)},M.attr=function(l,e,s){var t=s.type,n=s.param;if("css"===t)avalon(e).css(n,l);else if("attr"===t){var r=!1===l||null==l;!T&&_t[n]&&(n=_t[n]);var a=Nt[n];if("boolean"==typeof e[a]&&(e[a]=!!l,l||(r=!0)),r)return e.removeAttribute(n);!k.test(e)&&(!(!$.namespaces||!isVML(e))||n in e.cloneNode(!1))?e[n]=l+"":e.setAttribute(n,l)}else if("include"===t&&l){var c=s.vmodels,u=s.includeRendered,f=s.includeLoaded,p=s.includeReplace?e.parentNode:e,o=function(e){if(f){var t=f.apply(p,[e].concat(c));"string"==typeof t&&(e=t)}u&&function checkScan(t,n,r){var a=setTimeout(function(){var e=t.innerHTML;clearTimeout(a),e===r?n():checkScan(t,n,e)})}(p,function(){u.call(p)},NaN);var n=s.includeLastID;if(s.templateCache&&n&&n!==l){var r=s.templateCache[n];r||(r=s.templateCache[n]=$.createElement("div"),C.appendChild(r))}for(s.includeLastID=l;;){var a=s.startInclude.nextSibling;if(!a||a===s.endInclude)break;p.removeChild(a),r&&r.appendChild(a)}var o=function getTemplateNodes(e,t,n){var r=e.templateCache&&e.templateCache[t];if(r){for(var a,o=$.createDocumentFragment();a=r.firstChild;)o.appendChild(a);return o}return avalon.parseHTML(n)}(s,l,e),i=avalon.slice(o.childNodes);p.insertBefore(o,s.endInclude),scanNodeArray(i,c)};if("src"===s.param)if("string"==typeof jt[l])avalon.nextTick(function(){o(jt[l])});else if(Array.isArray(jt[l]))jt[l].push(o);else{var i=Ot();i.onreadystatechange=function(){if(4===i.readyState){var e=i.status;if(200<=e&&e<300||304===e||1223===e){for(var t,n=i.responseText,r=0;t=jt[l][r++];)t(n);jt[l]=n}}},jt[l]=[o],i.open("GET",l,!0),"withCredentials"in i&&(i.withCredentials=!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(null)}else{var d=l&&1===l.nodeType?l:$.getElementById(l);if(d){if("NOSCRIPT"===d.tagName&&!d.innerHTML&&!d.fixIE78){(i=Ot()).open("GET",location,!1),i.send(null);for(var v=$.getElementsByTagName("noscript"),h=(i.responseText||"").match(St)||[],m=h.length,y=0;y<m;y++){var g=v[y];g&&(g.style.display="none",g.fixIE78=(h[y].match(Mt)||["","&nbsp;"])[1])}}avalon.nextTick(function(){o(d.fixIE78||d.value||d.innerText||d.innerHTML)})}}}else if(E.hasAttribute||"string"!=typeof l||"src"!==t&&"href"!==t||(l=l.replace(/&amp;/g,"&")),e[t]=l,w.chrome&&"EMBED"===e.tagName){var b=e.parentNode,x=document.createComment("ms-src");b.replaceChild(x,e),b.replaceChild(e,x)}},"title,alt,src,value,css,include,href".replace(h,function(e){S[e]=S.attr}),S["class"]=function(e,t){var n,r=e.param,a=e.value;if(e.handlerName="class",!r||isFinite(r)){e.param="";var o=a.replace(W,function(e){return e.replace(/./g,"0")}).indexOf(":");if(-1===o){var i=a;n=!0}else i=a.slice(0,o),n=a.slice(o+1);i=z.test(a)?stringifyExpr(i):Ge(i),e.expr="["+i+","+n+"]"}else e.expr="["+Ge(r)+","+a+"]",e.oldStyle=r;var l=e.type;if("hover"===l||"active"===l){if(!e.hasBindEvent){var s=e.element,c=avalon(s),u="mouseenter",f="mouseleave";if("active"===l){s.tabIndex=s.tabIndex||-1,u="mousedown",f="mouseup";var p=c.bind("mouseleave",function(){e.toggleClass&&c.removeClass(e.newClass)})}}var d=c.bind(u,function(){e.toggleClass&&c.addClass(e.newClass)}),v=c.bind(f,function(){e.toggleClass&&c.removeClass(e.newClass)});e.rollback=function(){c.unbind("mouseleave",p),c.unbind(u,d),c.unbind(f,v)},e.hasBindEvent=!0}parseExprProxy(e.expr,t,e)},M["class"]=function(e,t,n){var r=avalon(t);n.newClass=e[0],n.toggleClass=!!e[1],n.oldClass&&n.newClass!==n.oldClass&&r.removeClass(n.oldClass),n.oldClass=n.newClass,"class"===n.type&&(n.oldStyle?r.toggleClass(n.oldStyle,!!e[1]):r.toggleClass(n.newClass,n.toggleClass))},"hover,active".replace(h,function(e){S[e]=S["class"]}),M.data=function(e,t,n){var r="data-"+n.param;e&&"object"==typeof e?t[r]=e:t.setAttribute(r,String(e))};var Lt=S.duplex=function(r,e){var t,a=r.element;if(parseExprProxy(r.value,e,r,1),r.changed=lt(a,"data-duplex-changed",e)||noop,r.evaluator&&r.args){var n=[],o=oneObject("string,number,boolean,checked");for(var i in"radio"===a.type&&""===r.param&&(r.param="checked"),a.msData&&(a.msData["ms-duplex"]=r.value),r.param.replace(/\w+/g,function(e){/^(checkbox|radio)$/.test(a.type)&&/^(radio|checked)$/.test(e)&&("radio"===e&&log("ms-duplex-radio已经更名为ms-duplex-checked"),e="checked",r.isChecked=!0),"bool"===e?(e="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===e&&(e="string",log("ms-duplex-text已经更名为ms-duplex-string")),o[e]&&(t=!0),avalon.Array.ensure(n,e)}),t||n.push("string"),r.param=n.join("-"),r.bound=function(e,t){a.addEventListener?a.addEventListener(e,t,!1):a.attachEvent("on"+e,t);var n=r.rollback;r.rollback=function(){a.avalonSetter=null,avalon.unbind(a,e,t),n&&n()}},avalon.vmodels){avalon.vmodels[i].$fire("avalon-ms-duplex-init",r)}(r.pipe||(r.pipe=pipe))(null,r,"init");var l=a.tagName;Lt[l]&&Lt[l](a,r.evaluator.apply(null,r.args),r)}};function fixNull(e){return null==e?"":e}function pipe(n,r,a,e){return r.param.replace(/\w+/g,function(e){var t=avalon.duplexHooks[e];t&&"function"==typeof t[a]&&(n=t[a](n,r))}),n}avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:fixNull},"boolean":{get:function(e){return"true"===e},set:fixNull},number:{get:function(e,t){var n=parseFloat(e);if(-e==-n)return n;switch((/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"])[0]){case"strong":return 0;case"medium":return""===e?"":0;case"weak":return e}},set:fixNull}};var Dt,Pt=[];function ticker(){for(var e=Pt.length-1;0<=e;e--){!1===(0,Pt[e])()&&Pt.splice(e,1)}Pt.length||clearInterval(Dt)}avalon.tick=function(e){1===Pt.push(e)&&(Dt=setInterval(ticker,60))};var Ht=noop,Ft=/text|password|hidden/;new function(){try{var t={},e=HTMLInputElement.prototype,n=HTMLTextAreaElement.prototype;function newSetter(e){t[this.tagName].call(this,e),Ft.test(this.type)&&!this.msFocus&&this.avalonSetter&&this.avalonSetter()}var r=HTMLInputElement.prototype;Object.getOwnPropertyNames(r),t.INPUT=Object.getOwnPropertyDescriptor(e,"value").set,Object.defineProperty(e,"value",{set:newSetter}),t.TEXTAREA=Object.getOwnPropertyDescriptor(n,"value").set,Object.defineProperty(n,"value",{set:newSetter})}catch(tn){Ht=avalon.tick}},u&&avalon.bind($,"selectionchange",function(e){var t=$.activeElement;t&&"function"==typeof t.avalonSetter&&t.avalonSetter()}),Lt.INPUT=function(r,a,o){var e=r.type,t=o.bound,i=avalon(r),n=!1;function callback(e){o.changed.call(this,e,o)}function compositionStart(){n=!0}function compositionEnd(){n=!1}var l=function(){var e=r.value;if(!n&&e!==r.oldValue){var t=o.pipe(e,o,"get");!1!==i.data("duplexObserve")&&(a(t),callback.call(r,t))}};if(o.handler=function(){var e=o.pipe(a(),o,"set")+"";e!==r.oldValue&&(r.value=r.oldValue=e)},o.isChecked||"radio"===e){var s=6===u;l=function(){if(!1!==i.data("duplexObserve")){var e=o.pipe(r.value,o,"get");a(e),callback.call(r,e)}},o.handler=function(){var e=a(),t=o.isChecked?!!e:e+""===r.value;r.oldValue=t,s?setTimeout(function(){r.defaultChecked=t,r.checked=t},31):r.checked=t},t("click",l)}else if("checkbox"===e)l=function(){if(!1!==i.data("duplexObserve")){var e=r.checked?"ensure":"remove",t=a();Array.isArray(t)||(log("ms-duplex应用于checkbox上要对应一个数组"),t=[t]);var n=o.pipe(r.value,o,"get");avalon.Array[e](t,n),callback.call(r,t)}},o.handler=function(){var e=[].concat(a()),t=o.pipe(r.value,o,"get");r.checked=-1<e.indexOf(t)},t(T?"change":"click",l);else{var c=r.getAttribute("data-duplex-event")||"input";function delay(e){setTimeout(function(){l(e)})}r.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),c.replace(h,function(e){switch(e){case"input":u?(8<u?t("input",l):t("propertychange",function(e){"value"===e.propertyName&&l()}),t("dragend",delay)):(t("input",l),t("compositionstart",compositionStart),t("compositionend",compositionEnd),t("DOMAutoComplete",l));break;default:t(e,l)}}),t("focus",function(){r.msFocus=!0}),t("blur",function(){r.msFocus=!1}),Ft.test(e)&&Ht(function(){if(E.contains(r))r.msFocus||r.oldValue===r.value||l();else if(!r.msRetain)return!1}),r.avalonSetter=l}r.oldValue=r.value,avalon.injectBinding(o),callback.call(r,r.value)},Lt.TEXTAREA=Lt.INPUT,Lt.SELECT=function(t,n,r){var a=avalon(t);r.handler=function(){var e=n();e=e&&e.$model||e,Array.isArray(e)?t.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):t.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),(e=Array.isArray(e)?e.map(String):e+"")+""!==t.oldValue&&(a.val(e),t.oldValue=e+"")},r.bound("change",function updateVModel(){if(!1!==a.data("duplexObserve")){var e=a.val();(e=Array.isArray(e)?e.map(function(e){return r.pipe(e,r,"get")}):r.pipe(e,r,"get"))+""!==t.oldValue&&n(e),r.changed.call(t,e,r)}}),t.msCallback=function(){avalon.injectBinding(r),r.changed.call(t,n(),r)}},M.html=function(e,t,n){var r=1!==t.nodeType,a=r?t.parentNode:t;if(a&&(e=null==e?"":e,n.oldText!==e)){if(n.oldText=e,3===t.nodeType){var o=A("html");a.insertBefore($.createComment(o),t),n.element=$.createComment(o+":end"),a.replaceChild(n.element,t),t=n.element}if("object"!=typeof e)var i=avalon.parseHTML(String(e));else if(11===e.nodeType)i=e;else if(1===e.nodeType||e.item){var l=1===e.nodeType?e.childNodes:e.item;for(i=_.cloneNode(!0);l[0];)i.appendChild(l[0])}if(l=avalon.slice(i.childNodes),r){for(var s=t.nodeValue.slice(0,-4);;){var c=t.previousSibling;if(!c||8===c.nodeType&&c.nodeValue===s)break;a.removeChild(c)}a.insertBefore(i,t)}else avalon.clearHTML(t).appendChild(i);scanNodeArray(l,n.vmodels)}},S["if"]=S.data=S.text=S.html=function(e,t){parseExprProxy(e.value,t,e)},M["if"]=function(e,t,n){try{if(!t.parentNode)return}catch(tn){return}if(e)8===t.nodeType&&(t.parentNode.replaceChild(n.template,t),t.ifRemove=null,t=n.element=n.template),t.getAttribute(n.name)&&(t.removeAttribute(n.name),scanAttr(t,n.vmodels)),n.rollback=null;else if(1===t.nodeType){var r=n.element=$.createComment("ms-if");t.parentNode.replaceChild(r,t),t.ifRemove=r,n.template=t,C.appendChild(t),n.rollback=function(){t.parentNode===C&&C.removeChild(t)}}};var It=/\(([^)]*)\)/;function shimController(e,t,n,r){var a=e.template.cloneNode(!0),o=avalon.slice(a.childNodes);a.insertBefore($.createComment(e.signature),a.firstChild),t.appendChild(a);var i={nodes:o,vmodels:[n].concat(e.vmodels)};r.push(i)}function sweepNodes(e,t,n){for(;;){var r=t.previousSibling;if(!r)break;if(r.parentNode.removeChild(r),n&&n.call(r),r===e)break}}S.on=function(e,t){var n=e.value;e.type="on";var r=e.param.replace(/-\d+$/,"");if("function"==typeof S.on[r+"Hook"]&&S.on[r+"Hook"](e),0<n.indexOf("(")&&-1<n.indexOf(")")){var a=(n.match(It)||["",""])[1].trim();""!==a&&"$event"!==a||(n=n.replace(It,""))}parseExprProxy(n,t,e)},M.on=function(e,t,n){e=function(e){return(n.evaluator||noop).apply(this,n.args.concat(e))};var r=n.param.replace(/-\d+$/,"");if("scan"===r)e.call(t,{type:r});else if("function"==typeof n.specialBind)n.specialBind(t,e);else var a=avalon.bind(t,r,e);n.rollback=function(){"function"==typeof n.specialUnbind?n.specialUnbind():avalon.unbind(t,r,a)}},S.repeat=function(e,t){var n=e.type;parseExprProxy(e.value,t,e,1);var r=!(e.proxies=[]);try{var a=e.$repeat=e.evaluator.apply(0,e.args||[]),o=avalon.type(a);"object"!==o&&"array"!==o?(r=!0,avalon.log("warning:"+e.value+"只能是对象或数组")):e.xtype=o}catch(tn){r=!0}var i=e.value.split(".")||[];if(1<i.length){i.pop();for(var l,s=i[0],c=0;l=t[c++];)if(l&&l.hasOwnProperty(s)){var u=l[s].$events||{};u[g]=u[g]||[],u[g].push(e);break}}var f=e.element;if(1===f.nodeType){f.removeAttribute(e.name),e.sortedCallback=lt(f,"data-with-sorted",t),e.renderedCallback=lt(f,"data-"+n+"-rendered",t);var p=A(n),d=$.createComment(p),v=$.createComment(p+":end");if(e.signature=p,e.template=_.cloneNode(!1),"repeat"===n){var h=f.parentNode;h.replaceChild(v,f),h.insertBefore(d,v),e.template.appendChild(f)}else{for(;f.firstChild;)e.template.appendChild(f.firstChild);f.appendChild(d),f.appendChild(v)}e.element=v,e.handler=M.repeat,e.rollback=function(){e.element&&e.handler("clear")}}if(!r){e.$outer={};var m="$key",y="$val";for(Array.isArray(a)&&(m="$first",y="$last"),c=0;l=t[c++];)if(l.hasOwnProperty(m)&&l.hasOwnProperty(y)){e.$outer=l;break}injectDependency((a.$events||{})[g],e),"object"===o?e.handler("append"):a.length&&e.handler("add",0,a.length)}},M.repeat=function(e,t,n){var r=this;if(!e&&r.xtype){var a=r.$repeat,o=r.evaluator.apply(0,r.args||[]);if("array"===r.xtype){if(a.length===o.length)return;e="add",t=0,n=(r.$repeat=o).length}else{if(keysVM(a).join(";;")===keysVM(o).join(";;"))return;e="append",r.$repeat=o}}if(e){var i,l,s=r.element,c=function getComments(e){for(var t,n=[],r=e.element.parentNode.childNodes,a=0;t=r[a++];)if(t.nodeValue===e.signature)n.push(t);else if(t.nodeValue===e.signature+":end")break;return n}(r),u=s.parentNode,f=r.proxies,p=_.cloneNode(!1);switch(e){case"add":for(var d=t+n,v=[],h=t;h<d;h++){var m=eachProxyAgent(h,r);f.splice(h,0,m),shimController(r,p,m,v)}for(u.insertBefore(p,c[t]||s),h=0;l=v[h++];)scanNodeArray(l.nodes,l.vmodels),l.nodes=l.vmodels=null;break;case"del":sweepNodes(c[t],c[t+n]||s),recycleProxies(f.splice(t,n));break;case"clear":(i=c[0])&&(sweepNodes(i,s),"object"===r.xtype?u.insertBefore(i,s):recycleProxies(f));break;case"move":if(i=c[0]){var y,g=i.nodeValue,b=[],x=[];for(sweepNodes(i,s,function(){x.unshift(this),this.nodeValue===g&&(b.unshift(x),x=[])}),sortByIndex(b,t),sortByIndex(f,t);x=b.shift();)for(;y=x.shift();)p.appendChild(y);u.insertBefore(p,s)}break;case"index":for(var w=f.length-1;n=f[t];t++)n.$index=t,n.$first=0===t,n.$last=t===w;return;case"set":(m=f[t])&&fireDependencies(m.$events[r.param||"el"]);break;case"append":var $=r.$repeat,C=Array.isArray(f)||!f?{}:f;r.proxies=C;var k=[];for(var T in v=[],C)$.hasOwnProperty(T)||(proxyRecycler(C[T],Bt),delete C[T]);for(T in $)$.hasOwnProperty(T)&&"hasOwnProperty"!==T&&k.push(T);if(r.sortedCallback){var E=r.sortedCallback.call(u,k);E&&Array.isArray(E)&&E.length&&(k=E)}for(h=0;T=k[h++];)"hasOwnProperty"!==T&&(C[T]=withProxyAgent(C[T],T,r),shimController(r,p,C[T],v));for(u.insertBefore(p,s),h=0;l=v[h++];)scanNodeArray(l.nodes,l.vmodels),l.nodes=l.vmodels=null}if(!r.$repeat||r.$repeat.hasOwnProperty("$lock"))return;"clear"===e&&(e="del");var A=r.renderedCallback||noop,N=arguments;u.oldValue&&"SELECT"===u.tagName&&avalon(u).val(u.oldValue.split(",")),A.apply(u,N)}},"with,each".replace(h,function(e){S[e]=S.repeat});var Bt=[];function withProxyAgent(e,t,n){(e=e||Bt.pop())?e.$reinitialize():e=function withProxyFactory(){var e=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(e){this.$host[this.$key]=e}}},{$val:1});return e.$id=A("$proxy$with"),e}();var r=n.$repeat;return e.$key=t,e.$host=r,e.$outer=n.$outer,r.$events?e.$events.$val=r.$events[t]:e.$events={},e}function recycleProxies(e){!function eachProxyRecycler(e){e.forEach(function(e){proxyRecycler(e,Vt)}),e.length=0}(e)}var Vt=[];function eachProxyAgent(e,t){for(var n,r=t.param||"el",a=0,o=Vt.length;a<o;a++){var i=Vt[a];i&&i.hasOwnProperty(r)&&(n=i,Vt.splice(a,1))}n||(n=function eachProxyFactory(n){var e={$host:[],$outer:{},$index:0,$first:!1,$last:!1,$remove:avalon.noop};e[n]={get:function(){var e=this.$events,t=e.$index;e.$index=e[n];try{return this.$host[this.$index]}finally{e.$index=t}},set:function(e){try{var t=this.$events,n=t.$index;t.$index=[],this.$host.set(this.$index,e)}finally{t.$index=n}}};var t=modelFactory(e,{$last:1,$first:1,$index:1});return t.$id=A("$proxy$each"),t}(r));var l=t.$repeat,s=l.length-1;return n.$index=e,n.$first=0===e,n.$last=e===s,n.$host=l,n.$outer=t.$outer,n.$remove=function(){return l.removeAt(n.$index)},n}function proxyRecycler(e,t){for(var n in e.$events){var r=e.$events[n];Array.isArray(r)&&(r.forEach(function(e){"object"==typeof e&&disposeData(e)}),r.length=0)}e.$host=e.$outer={},t.unshift(e)>kernel.maxRepeatSize&&t.pop()}function parseDisplay(e,t){var n="_"+e;if(!parseDisplay[n]){var r=$.createElement(e);E.appendChild(r),t=T?getComputedStyle(r,null).display:r.currentStyle.display,E.removeChild(r),parseDisplay[n]=t}return parseDisplay[n]}M.text=function(e,t){if(e=null==e?"":e,3===t.nodeType)try{t.data=e}catch(tn){}else"textContent"in t?t.textContent=e:t.innerText=e},avalon.parseDisplay=parseDisplay,S.visible=function(e,t){parseExprProxy(e.value,t,e)},M.visible=function(e,t,n){e?(t.style.display=n.display||"","none"===avalon(t).css("display")&&(t.style.display=n.display=parseDisplay(t.nodeName))):t.style.display="none"},S.widget=function(e,t){var n=e.value.match(h),r=e.element,a=n[0],o=n[1];o&&"$"!==o||(o=A(a));var i=n[2]||a,l=avalon.ui[a];if("function"==typeof l){t=r.vmodels||t;for(var s,c=0;s=t[c++];)if(s.hasOwnProperty(i)&&"object"==typeof s[i]){var u=s[i];u=u.$model||u;break}if(u){var f=u[a+"Id"];"string"==typeof f&&(log("warning!不再支持"+a+"Id"),o=f)}var p=avalon.getWidgetData(r,a);e.value=[a,o,i].join(","),e[a+"Id"]=o,e.evaluator=noop,r.msData["ms-widget-id"]=o;var d=e[a+"Options"]=avalon.mix({},l.defaults,u||{},p);r.removeAttribute("ms-widget");var v=l(r,e,t)||{};if(v.$id){avalon.vmodels[o]=v,createSignalTower(r,v);try{v.$init(function(){avalon.scan(r,[v].concat(t)),"function"==typeof d.onInit&&d.onInit.call(r,v,d,t)})}catch(tn){}e.rollback=function(){try{v.$remove(),v.widgetElement=null}catch(tn){}r.msData={},delete avalon.vmodels[v.$id]},injectDisposeQueue(e,Rt),w.chrome&&r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(rejectDisposeQueue)})}else avalon.scan(r,t)}else t.length&&(r.vmodels=t)};var Rt=[],Gt=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,zt=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,Wt=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,Ut={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},Xt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Yt=/([^\#-~| |!])/g;function numberFormat(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a,o,i,l=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):3,c=r||",",u=n||".",f="";return 3<(f=(s?(a=l,o=s,i=Math.pow(10,o),""+(Math.round(a*i)/i).toFixed(o)):""+Math.round(l)).split("."))[0].length&&(f[0]=f[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,c)),(f[1]||"").length<s&&(f[1]=f[1]||"",f[1]+=new Array(s-f[1].length+1).join("0")),f.join(u)}var qt=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n="string"==typeof n?n:"...",e.length>t?e.slice(0,t-n.length)+n:String(e)},$filter:function(e){for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t],a=avalon.filters[r[0]];if("function"==typeof a){var o=[e].concat(r.slice(1));e=a.apply(null,o)}}return e},camelize:camelize,sanitize:function(e){return e.replace(Gt,"").replace(Wt,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=Ut[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(zt," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(Xt,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(Yt,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t,n){return(t||"￥")+numberFormat(e,isFinite(n)?n:2)},number:numberFormat};new function(){function toInt(e){return parseInt(e,10)||0}function padNumber(e,t,n){var r="";for(e<0&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function dateGetter(n,r,a,o){return function(e){var t=e["get"+n]();return(0<a||-a<t)&&(t+=a),0===t&&-12===a&&(t=12),padNumber(t,r,o)}}function dateStrGetter(r,a){return function(e,t){var n=e["get"+r]();return t[(a?"SHORT"+r:r).toUpperCase()][n]}}var v={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,!0),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:function ampmGetter(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]},Z:function timeZoneGetter(e){var t=-1*e.getTimezoneOffset(),n=0<=t?"+":"";return n+=padNumber(Math[0<t?"floor":"ceil"](t/60),2)+padNumber(Math.abs(t%60),2)}},h=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,m=/^\/Date\((\d+)\)\/$/;qt.date=function(t,e){var n,r,a=qt.date.locate,o="",i=[];if(e=a[e=e||"mediumDate"]||e,"string"==typeof t)if(/^\d+$/.test(t))t=toInt(t);else if(m.test(t))t=+RegExp.$1;else{var l=t.trim(),s=[0,0,0,0,0,0,0],c=new Date(0);l=l.replace(/^(\d+)\D(\d+)\D(\d+)/,function(e,t,n,r){var a=4===r.length?[r,t,n]:[t,n,r];return s[0]=toInt(a[0]),s[1]=toInt(a[1])-1,s[2]=toInt(a[2]),""});var u=c.setFullYear,f=c.setHours;l=l.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(e,t,n,r,a){return s[3]=toInt(t),s[4]=toInt(n),s[5]=toInt(r),a&&(s[6]=Math.round(1e3*parseFloat("0."+a))),""});var p=0,d=0;l=l.replace(/Z|([+-])(\d\d):?(\d\d)/,function(e,t,n,r){return u=c.setUTCFullYear,f=c.setUTCHours,t&&(p=toInt(t+n),d=toInt(t+r)),""}),s[3]-=p,s[4]-=d,u.apply(c,s.slice(0,3)),f.apply(c,s.slice(3)),t=c}if("number"==typeof t&&(t=new Date(t)),"date"===avalon.type(t)){for(;e;)(r=h.exec(e))?e=(i=i.concat(r.slice(1))).pop():(i.push(e),e=null);return i.forEach(function(e){o+=(n=v[e])?n(t,a):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),o}};var e={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};e.SHORTMONTH=e.MONTH,qt.date.locate=e};var Jt,Qt=[],Zt=function(e){for(Jt=!0;e=Qt.shift();)e(avalon)};if("complete"===$.readyState)setTimeout(Zt);else if(T)$.addEventListener("DOMContentLoaded",Zt);else{$.attachEvent("onreadystatechange",function(){"complete"===$.readyState&&Zt()});try{var Kt=null===w.frameElement}catch(tn){}E.doScroll&&Kt&&w.external&&function doScrollCheck(){try{E.doScroll("left"),Zt()}catch(tn){setTimeout(doScrollCheck)}}()}avalon.bind(w,"load",Zt),avalon.ready=function(e){Jt?e(avalon):Qt.push(e)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan($.body)}),"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon});var en=w.avalon;return avalon.noConflict=function(e){return e&&w.avalon===avalon&&(w.avalon=en),avalon},void 0===e&&(w.avalon=avalon),avalon}),avalon.config({loader:!1});