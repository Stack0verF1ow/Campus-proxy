define("views/service/service",["common/index"],function(i){"use strict";var d,r,h,t={},o={maxWidth:1330,maxHeight:768,minWidth:1110,minHeight:620},n={mobile:"mobile",min:"min",max:"max",curr:""},a={mobile:"rs-mobile-screen",min:"rs-min-screen",max:"rs-max-screen"},s="auto",c="px",l=0,u=0,f=7,g=32,m=!1,p=[],S=!0,v=[],_=SF.res,T=window.SF.resConfig,w=SF.rc.store,I={},E=8,N=!1,b=i.utils,y=!1,D=SFLOG,C="ui:service",R=b.isWeb,A=SFConfig,x=SF.rc.define.rcType,L=0,F=!1,O=!1,k=function(){},B=["默认资源组","外部资源组","web全网资源(或服务)","L3VPN全网资源(或服务)"],P="欢迎使用EasyConnect，让您的系统接入更安全，体验更好！";function _scrollToLocation(e){var t=e,n=-(h.rslistData.length-f)*g;I.quickNavTypeList&&(0<e?t=0:e<=n&&(t=n),h.listTypeStatus="center",0<t+g?h.listTypeStatus="top":t-g<n&&(h.listTypeStatus="bottom",t=n),h.rslistData.length>=f&&(I.quickNavTypeList.style.marginTop=t+c))}function _resizeDomData(){l=b.screen().width,u=b.screen().height}function _setNoticeShow(e){var t,n=!0;I.noticeDetail&&h.rsInfo.tipsService?(D.debug(C,"update notice bar state"),t=!is.bool(I.noticeDetail.fold)||I.noticeDetail.fold,I.noticeDetail.offsetHeight||D.debug(C,"Offset of notice is 0, no notice to show."),I.noticeDetail.offsetHeight<45&&(n=!1),e&&n&&(n=!(t=!1)),h.noticeUnfold=!0,I.noticeDetail.fold=!1,h.noticeBtnText="",!t&&n&&(h.noticeBtnText=tr("展开")),t&&n&&(h.noticeUnfold=!1,h.noticeBtnText=tr("收起"),I.noticeDetail.fold=!0)):D.debug(C,"Element is not exist or tips content is empty, not update notice bar.")}function _pageAutoAdapt(){var e;h.screenNum=(I.rsScroll.scrollHeight/(u<500?500:u)).toFixed(2),e=is.System().isMobile?n.mobile:l>=o.maxWidth?n.max:n.min,l<o.minWidth&&e!==n.mobile?I.rsBody.style.width=o.minWidth+c:I.rsBody.style.width=s,e!==n.curr&&I.rsBody&&(I.rsBody.className=I.rsBody.className.replace(a[n.curr],"")+" "+a[e]),n.curr=e,I.rsScroll&&(I.rsScroll.style.height=(0<u-I.rsScroll.offsetTop?u-I.rsScroll.offsetTop:0)+c,_resizeDomData(),I.rsScroll.style.height=(0<u-I.rsScroll.offsetTop?u-I.rsScroll.offsetTop:0)+c),function _setQuickNavTop(){if(!I.rsWrapEle)return void D.debug(C,'id "rsWrap" not exits. nav cannot response');I.quickNavEle&&n.mobile!==n.curr&&(I.quickNavEle.style.left=I.rsWrapEle.offsetLeft+I.rsWrapEle.clientWidth-160+13+c,u<I.quickNavEle.clientHeight+I.rsWrapEle.offsetTop?(I.quickNavEle.style.top="140px",I.quickNavEle.style.bottom=s):(I.quickNavEle.style.top=s,I.quickNavEle.style.bottom="9px"))}()}function _quickNavScrollEvent(){var e,t,n=I.rsScroll.scrollTop,o=I.allTitle,i=0,r=o.length;if(!(h.rslistData.length<=1)){for(e=r-1;0<e;e--)if(o[e].offsetTop-60+I.rsList.offsetTop-I.rsScroll.offsetTop<=n){i=e;break}t=r-4<=i?r-f:i-3,i<3&&(t=0),h.listTypeStatus=i<=3?"top":r-4<i?"bottom":"center",N?_scrollToLocation(-(t=h.listTypeChoose-3)*g):(h.listTypeChoose=i,_scrollToLocation(-t*g))}}function _searchRs(){var e,t,n,o=p,i=[],r=h.rsSearchVal.toLowerCase(),a=h.rsSearchVal.toString();if(50<b.getStrInfo(a)&&(a=b.getStrInfo(a,50)+"..."),h.rsSearchKey=tr("搜索“{0}”资源",a),!h.rsSearchVal)return h.searchData=[],h.searchIsNull=!0,h.searchLengthText=tr("搜索到匹配的资源为{0}个",'<span class="theme-font-color">0</span>'),_scrollToLocation(0),h.listTypeChoose=0,void _quickNavScrollEvent();for(I.rsScroll.scrollTop=0,h.searchIsNull=!1,e=0;e<o.length;e++)if(0<=o[e].name.toLowerCase().indexOf(r))i.push(o[e]);else{for(n=!1,t=0;t<o[e].addr_link.length;t++)if(0<=o[e].addr_link[t].toLowerCase().indexOf(r)){n=!0;break}n&&i.push(o[e])}h.searchData.removeAll(),h.searchData=i,h.searchLengthText=tr("搜索到匹配的资源为{0}个",'<span class="theme-font-color">'+i.length+"</span>")}function _toRsLocation(){var e=h.$searchAllNetKey;e&&_.sf_handle_websvc(e)}function _renderRcData(r){var t,a=20,s=50;function onRenderFinished(){!function mapBalanceDataToPage(){if(!A.isExistEC||!w.data.hasLoadBalanceRc)return;SFAPI.fetchBalanceData({success:function(e){var t=[];is.array(e.data)&&(t=e.data.map(function(e){return xmlToJSON.parseString(Base64.decode(e))})),t.forEach(function(e){modifyBalanceData(h.rslistData,e.BalancerUpdateRc)}),D.info(C,"Init balance successully!")},error:function(e){D.error(C,"unexpected responsed data","cannot get babanlce message from "+JSON.stringify(e))}})}(),setTimeout(function(){_pageAutoAdapt()},a)}h.rslistData=[],r.forEach(function(e){-1<(t=B.indexOf(e.name))&&(e.name=tr(B[t])),h.rslistData.push({name:e.name,id:e.id,rcs:[]})}),function renderRcByPage(e,t){var n,o,i;o=r[e];if(!o)return;for(n=0;n<s;n++){if(!(i=r[e].rcs[t])){if(t=0,!(o=r[++e]))return void onRenderFinished();i=o.rcs[t]}h.rslistData[e].rcs.push(i),t++}setTimeout(function(){renderRcByPage(e,t)},a)}(0,0)}function _updateRcsState(e){var t,n,o,i,r,a,s=T.rc.rcsHash,c=h.rslistData.length,l=h.searchData.length;for(D.assert(is.number(e),"update rc state params must be number"),n=0;n<c;n++)for(t=(a=h.rslistData[n].rcs).length,o=0;o<t;o++)r=a[o],/^webapp:https?$/i.test(s[r.id].svc)&&""===T.config.webvpn.hostname?(a[o].state=!1,a[o].msg=tr("新版WEB资源需要先开启泛域名")):_updateRcState(a[o],e);for(i=0;i<l;i++)_updateRcState(h.searchData[i],e)}function _updateRcState(e,t){var n,o,i,r=T.rc.rcsHash,a="";if((null===t||e.type===t)&&(e.state=r[e.id].state,e.curState=r[e.id].curState,e.msg=r[e.id].msg,2<(o=(n=w.initEachRcState(e)).msg.split("\n")).length)){for(a=o[0]+"\n",i=1;i<o.length-1;i++)a+=i+". "+o[i]+"\n";n.msg=a}}function _initPage(){var e,t=T.rc.allData||[];if(h.rsInit)D.debug(C,"service page already inited. skip this method.");else{if(h.ecIsExist=SFConfig.isExistEC,function _initRsData(){var e,t,n,o,i,r,a,s=T.rc.allData,c=T.rc.pureData,l=T.config.securityStrategyHash,u=T.rc.strategyData||[],d=u.length,h=[],f=function(e){var t=e.rc_logo,n=t.indexOf("_font_face_"),o=-1!==n,i=o?t.substr(n+11,5):"";e.isIconFont=o,e.unicode="&#"+i+";"};if(!s||!c)return!1;for(n=0;n<u.length;n++)u[n].rsIndex=n,h.push(Number(u[n].rcID));for(e=0;e<s.length;e++)if(s[e].rcs)for(t=0;t<s[e].rcs.length&&(s[e].rcs[t].isHover=!1,s[e].rcs[t].loadingHeight=0,r=s[e].rcs[t],f(r),!(0<=(i=h.indexOf(s[e].rcs[t].id))&&l&&u&&(r.authorization===u[i].check&&r.auth_sp_id===u[i].sid||(r.authorization=u[i].check,r.auth_sp_id=u[i].sid),0===s[e].rcs[t].authorization&&-1e3<r.id&&(a=l[u[i].sid],r.state=!1,r.msg='不满足安全策略"'+a.name+(a.note?"("+a.note+")":"")+'" \n'),(d-=1)<0)));t++);for(T.rc.pureData=[],o=0;o<s.length;o++)T.rc.pureData=T.rc.pureData.concat(s[o].rcs),T.rc.isShowTips=!1}(),_renderRcData(t),p=T.rc.pureData||[],h.exitAllNet=w.data.hasWebAllNetRc,_resizeDomData(),function _initDom(){I.rsBody=document.getElementById("service"),I.rsScroll=document.getElementById("rsScroll")||I.rsBody,I.rsWrapEle=document.getElementById("rsWrap"),I.searchRsInput=document.getElementById("searchRsInput"),I.searchAllNetInput=document.getElementById("searchAllNetInput"),I.quickNavEle=document.getElementById("rsQuickNav"),I.quickNavTypeList=document.getElementById("rsQuickNavTypeList"),I.noticeDetail=document.getElementById("noticeDetailItem"),I.rsList=document.getElementById("rsList"),I.allTitle=b.getElementsByClassName("rs-list__title",I.rsList),I.hintInfos=document.getElementById("hintInfos")}(),e=I.rsBody.getAttribute("data-screen-params")){try{o=JSON.parse(e)}catch(n){D.error(C,"data-screen-params not object. default use params","id attribute data-screen-params error")}(o=avalon.mix(o)).autoAdapt=is.bool(o.autoAdapt)&&o.autoAdapt}!function _initEvent(){var e=!!b.isClient;I.quickNavEle&&(I.quickNavEle.onmousewheel=function quickNavBoxScroll(e){var t=0;(e=e||window.event).wheelDelta&&(t=e.wheelDelta/120),window.opera?t=-t:e.detail&&(t=-e.detail/3),t&&h.onListTypeOperate(0<=t?"prev":"next"),is.IE()>E?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1)}),b.addEvent(I.rsScroll,"scroll",function(){I.allTitle&&I.allTitle.length&&_quickNavScrollEvent()}),o.autoAdapt||b.addEvent(window,"resize",function(){avalon(document.body).css("min-height",(document.compatMode&&"css1compat"===document.compatMode.toLowerCase()?document.documentElement:document.body).clientHeight),_resizeDomData(),_pageAutoAdapt(),_setNoticeShow(e),l<=o.minWidth?h.maxState=!1:h.maxState=!0,e=!1}),avalon.bind(document,"click",function(){m?m=!1:h.searchTypeShow=!0,y||(h.currClickRsId=null),y=!1,v.length&&(v[v.currIndex].bubble?v[v.currIndex].bubble=!1:(b.getNextElement(v[v.currIndex]).parentNode.style.zIndex="",b.getNextElement(v[v.currIndex]).style.display="none"))})}(),T.info&&T.info.loginName&&(h.userInfo.username=T.info.loginName,h.userInfo.showUsername=T.info.loginName,7<b.getStrInfo(h.userInfo.showUsername)&&(h.userInfo.showUsername=b.getStrInfo(h.userInfo.showUsername,7)+"...")),o.autoAdapt||_pageAutoAdapt(),_setNoticeShow(h.rsInit=!0)}}function _initHintInfo(){var e,t,n,o=0,i=2;if(D.debug(C,"init hint content"),T.config.selfLogin&&w.data.hasL3vpnRc&&!SFCommon.isFreeMode()?h.topHintText="● "+tr("系统检测您登录了多个VPN，下面显示为灰色的资源将无法使用，只有第一个登录的VPN才能使用L3VPN资源")+" \n":!h.rsInfo.hasDisabledRc||h.ecIsExist||SFCommon.isFreeMode()||(h.topHintText="● "+tr("系统检测您尚未安装客户端，资源列表中显示为灰色的资源将无法使用。")+" \n"),0<(n=parseInt(SF.setting.getGlobal(KEY_GLOBAL_PSW_REMAIN_TIME,0),0))&&(SF.setting.setGlobal({key:KEY_GLOBAL_PSW_REMAIN_TIME,value:0},!1),h.pwdOverdueHint="● "+tr("您的密码将在{0}天以后过期，请",n),b.isClient&&SF.windowMgr.registEvents("clientUpdatePwd",function(){h.pwdOverdueHint=""})),h.topHintText&&h.pwdOverdueHint&&I.hintInfos&&I.hintInfos.children&&1<I.hintInfos.children.length){for(i=(t=I.hintInfos.children).length,o=I.hintInfos.children[0].clientHeight,I.hintInfos.parentNode.style.height=o+c,e=0;e<i;e++)t[e].style.height=o+c;r=function _scrollHints(e,t){var n,o;return n={create:function(){return function(){this.initialize.apply(this,arguments)}}},Function.prototype.bind=function(e){var t=this;return function(){t.apply(e,arguments)}},(o=n.create()).prototype={initialize:function(e,t){var n=this;n.isStop=!1,n.element=function _getDomEle(e){var t,n;if(1<arguments.length){for(n=0,length=arguments.length,t=[];n<length;n++)t.push(_getDomEle(arguments[n]));return t}return is.string(e)?document.getElementById(e):e}(e),n.height=t,n.maxHeight=n.element.scrollHeight/2,n.counter=0,setTimeout(function(){n.scroll()},5e3),n.timer=null,n.element.onmouseenter=n.stop.bind(n),n.element.onmouseleave=function(){n.isStop=!1,(n.counter<1||n.counter>=n.height)&&(clearTimeout(n.timer),n.timer=null,n.timer=n.animateTimeout(n.scroll.bind(n),5e3))}.bind(n)},scroll:function(){var e=this;if(e.element.children.length<=1||e.isStop&&(0===e.element.scrollTop||e.element.scrollTop%e.height==0))return clearTimeout(e.timer),void(e.timer=null);e.element.scrollTop<e.maxHeight?(e.element.scrollTop++,e.counter++):(e.element.scrollTop=0,e.counter=0),clearTimeout(e.timer),e.timer=null,e.counter<e.height?e.timer=setTimeout(e.scroll.bind(e),22):(e.counter=0,e.isStop||(e.timer=e.animateTimeout(e.scroll.bind(e),5e3)))},stop:function(){this.isStop=!0},animateTimeout:function(e,t,n){var o=this;n||(n=(new Date).getTime()),(new Date).getTime()-n>=t?e():(clearTimeout(o.timer),o.timer=null,o.timer=setTimeout(function(){o.animateTimeout(e,t,n)},500))}},new o(e,t)}(I.hintInfos,o)}}function _checkUnAuthData(){SFAPI.getUnAuthRes({success:function(e){D.info(C,"get unauth data success "),SFCommon.checkObjAttrExits(e,"data.rc")&&function _onGetUnAuthData(e){var t,n,o,i=h.rslistData,r={};if(e){for(t=0;t<e.length;t++)"0"===e[t].check&&(r[e[t].rcID]=e[t]);for(n=0;n<i.length;n++)for(o=0;o<i[n].rcs.length;o++)_handleAuthResource(r,i[n].rcs[o])}}(e.data.rc)},error:function(e){D.error(C,"Failed to acquire unauthorized resource","error is %s ",e.msg)}})}function _handleAuthResource(e,t){var n,o={},i=T.config.securityStrategyHash;if(e[t.id]){if(o[t.id]=e[t.id],!t.state)return;n=i[e[t.id].sid],t.state=!1,t.curState=A.SERVICE_INIT_STATE.DISABLE,t.msg+=tr("不满足安全策略")+'"'+n.name+(n.note?"("+n.note+")":"")+'" \n',T.rc.unAuth.push(o)}else t.state||(t.state=!0,w.initEachRcState(t))}function modifyBalanceData(e,t){var n={};t&&t.Rc&&(n=t.Rc,e.forEach(function(e){return parseInt(e.id,10)===parseInt(n.rc_grp_id,10)&&is.array(e.rcs)&&e.rcs.forEach(function(e){parseInt(e.id,10)===parseInt(n.id,10)&&function(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t[n])switch(n){case"type":e[n]=1*t[n];break;case"svc":e[n]=t[n].toLowerCase();break;case"port":e[n]=t[n].split("~")[0];break;case"rc_logo":e[n]="/por/svpnrcico/"+t[n];break;case"enable_disguise":e[n]=parseInt(t[n],10);break;default:e[n]=t[n]}e.ips[0]={host_from:t.host,host_to:"",isBalanced:!0},e.addr_link=[t.host],w.resetRcById(e.id,e)}(e,n)}),e}))}function _checkLoginStatus(){b.isWeb&&!T.config.otherLogin&&SF.registLoginStatusEvent({conCount:10,byServer:T.info.isOnlyWeb,preventOnError:!0,expected:[SFConfig.LOGIN_STATUS.LOGOUT],onLogout:function(e){var t=!1;is.object(e)&&SFCommon.checkObjAttrExits(e,"data.logoutType")&&e.data.logoutType===SFConfig.INITIATIVE_LOGOUT&&(t=!0,SF.setting.setGlobal({key:KEY_GLOBAL_IS_USER_LOGOUT,value:!0},!1)),function _onLogout(e){i.logoutHandle(e),is.WebClient&&h.$fire("all!sessionEvent","logout")}(t)},onOnLine:function(e){e.data.resSecChk!==L&&A.isExistEC&&(L=e.data.resSecChk,_checkUnAuthData())},error:function(){SFCommon.onError({subTitle:tr("网络请求失败"),btnText:tr("刷新"),closeBtn:!1,clickAction:function(){window.location.reload()}})}})}return SFConfig._checkUnAuthData=_checkUnAuthData,t.getVModelConfig=function(){return{$id:"service",rslistData:[],listTypeChoose:0,exitAllNet:!1,listTypeStatus:"top",searchTypeShow:!0,searchDefaultChoose:0,rsAllNetSearchFocusStatus:!1,searchData:[],rsSearchKey:"",rsSearchVal:"",$searchAllNetKey:"http://",searchIsNull:!0,settingListShow:!0,ecIsExist:!1,rsSearchFocusStatus:!1,noticeUnfold:!0,screenNum:0,isNotInitFinish:!0,maxState:!1,$isClientAndNotMac:b.isClient&&!is.Mac,$isClient:b.isClient,$isLinuxClient:b.isLinuxClient,$isMobile:head.mobile,$isPad:is.iPad,rsInfo:{hasDisabledRc:null,groupName:"",backgroundImg:"",logo:"",tipsService:""},userInfo:{username:"",showUsername:""},rsInit:!1,$hintText:{clear:"",search:"",allNet:"",rsSearch:"",nowGo:"",loadBalance:"",addrList:"",nowUpdatePwd:"",downloadClient:""},searchLengthText:"",topHintText:"",noticeBtnText:"",pwdOverdueHint:"",currClickRsId:null,isEnglish:!1,isLinuxClientOrMacPlatform:is.LinuxClient||is.Mac,handleLoadingRS:function(n,o){var i;n.isHover=o,SFCommon.isWinClient()?n.loadingHeight=o?48:0:i=setInterval(function(){var e=o?4:-4,t=n.loadingHeight;n.isHover===o?(t+=e,e+=10,o?t<48?n.loadingHeight=t:(n.loadingHeight=48,clearInterval(i)):0<t?n.loadingHeight=t:(n.loadingHeight=0,clearInterval(i))):clearInterval(i)},20)},$onEnter:function(){},$onRendered:function(){var e=SF.setting.getGlobal(KEY_GLOBAL_LANG,window.language);!function _wechatDataDeal(){var e=SF.setting.getGlobal(KEY_GLOBAL_WECHAT_BINDDATA),t=SF.setting.getVPN(KEY_VPN_TEMP_FIRST_AUTH,"");e&&"bind"===e.status&&SF.setting.setGlobal({key:KEY_GLOBAL_WECHAT_BINDDATA,value:{}},!1),D.info("wechat:qrcode"," get KEY_VPN_TEMP_FIRST_AUTH result is "+t),"auth/wechat"===t&&(D.info(C,"save auth/wechat  to KEY_VPN_FIRST_AUTH"),SF.setting.setVPN({key:KEY_VPN_FIRST_AUTH,value:"auth/wechat"},!0)),"auth/wechat"!==t&&SFCommon.isWeb()&&SF.setting.setVPN({key:KEY_VPN_FIRST_AUTH,value:""},!0)}(),avalon.vmodels.service&&(document.body.className+=" overflow-y",(h=t.vmodel).isEnglish="zh_CN"!==e&&""!==e,R||(!function _registEvent(){A.isExistEC&&(SF.windowMgr.registEvents(EVENT_CHECK_UNAUTH_DATA,function(){D.info(C,"recv event check unauth data"),F?(D.info(C,"the current service is ready, checking unauth data！"),_checkUnAuthData()):(D.info(C,"the current service is not ready, wait a moment！"),k=_checkUnAuthData)}),SF.windowMgr.registEvents(EVENT_ON_SESSION_CHANGE,function(){var e=SF.setting.getGlobal(KEY_GLOBAL_TWFID,"");D.info(C,"recv onSessionChange event"),SFAPI.cookieSaveLocal({success:function(){D.info(C,"updated local twfid")}},e)}))}(),SF.windowMgr.registEvents("onWindowShouldClose",function(){SFCommon.onExit()})),i.i18n.change(h,e,function(){h.$hintText={clear:tr("清除"),search:tr("搜索"),allNet:tr("全网资源"),rsSearch:tr("资源搜索"),nowGo:tr("立即前往"),loadBalance:tr("负载均衡"),addrList:tr("地址列表"),nowUpdatePwd:tr("前往修改"),downloadClient:tr("下载客户端")},i.loader.renderPlugin({name:PORTAL_MAP["other/_service_init"],data:{isFromService:!0,onRcReadyShow:function(){_initPage(),function _initEcWindow(){var e,t,n,o=1110,i=300,r=SFConfig.SERVICE_SHOW_TIME;D.info(C,"Resource ready to show, start init page"),b.isWeb||(SF.windowMgr.triggerEvent(EVENT_CLAER_SERVICE_TIMEOUT_TIMER,{}),T.config.showRc||SF.windowMgr.hide(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW),SF.windowMgr.resize(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW,o,620),SF.windowMgr.moveTo(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW,o,620,!0),T.config.showRc&&!T.config.needGoDefault&&(e=(new Date).getTime(),window.serviceStartTime=window.serviceStartTime?window.serviceStartTime:e-r-1,n=e-window.serviceStartTime,D.info(C,"delay to show service:startTime:"+window.serviceStartTime+",endTime:"+e+",subValue:"+n+",timeSpan:"+r),n<r&&(i=i+r-n),setTimeout(function(){t=(new Date).getTime(),D.info(C,"exec command for showing service:curTime:"+t+",endTime:"+e+",subValue:"+(t-window.serviceStartTime)+",timeSpan:"+r),SF.windowMgr.show(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW),is.LinuxClient&&(SF.windowMgr.resize(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW,o,619),SF.windowMgr.moveTo(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW,o,620,!0),SF.windowMgr.resize(SFConfig.CONTAINER_WINDOW_ID.CURRENT_WINDOW,o,620)),SF.windowMgr.triggerEvent(EVENT_ON_SERVICE_SHOW,"{}")},i)))}(),_updateRcsState(x.WEB)},onTcpFinished:function(){_updateRcsState(x.APP)},onL3vpnFinished:function(){_updateRcsState(x.IP)},onFinished:function(){_checkLoginStatus(),h.rsInfo.hasDisabledRc=w.data.hasDisabledRc,_initHintInfo()},onLogout:function(){var e=SF.setting.getGlobal(KEY_GLOBAL_IS_USER_LOGOUT,0);D.info(C,"logout when starting service, is user logout:"+e),e||_checkLoginStatus()},onServiceFinish:function(){O=F=!0,D.info(C,"start service finish"),is.fn(k)&&k()}},success:function(){D.debug(C,"service init loaded success")}}),SFCommon.getThemeConfigInfo(function(e){var t;e&&(t=e.rand?"?r="+e.rand:"",h.rsInfo.logo=e.logo?"theme/images/"+e.logo+t:"theme/images/logo.png",h.rsInfo.tipsService=e.tipsService||"",h.rsInfo.tipsService===P&&(h.rsInfo.tipsService=tr(P)),h.rsInfo.groupName=e.organizeName||"",document.title=i.utils.getTitle(e.title),_setNoticeShow(!0))})}))},$onBeforeUnload:function(){!function _resetPage(){h.rsInit=!1,b.removeEvent(window,"scroll",function(){}),b.removeEvent(window,"resize",function(){}),avalon.unbind(document,"click",function(){})}()},onQuickClick:function(e){!function _animateToDirection(e,t){var n,o,i,r,a=2,s=!1,c=I.rsScroll.clientHeight,l=I.rsScroll.scrollTop>e?"up":"down",u=Math.abs(I.rsScroll.scrollTop-e);function _calulate(){if(s)return N=!1,void clearInterval(d);o=I.rsScroll.scrollTop,"down"===l?(n=Math.floor((e-o)/a),i=o+(n=n<20?20:n)):(n=Math.floor((o-e)/a),i=o-(n=n<20?20:n)),I.rsScroll.scrollTop=i,"down"===l?e<=o+5&&(I.rsScroll.scrollTop=e,s=!0):o-5<=e&&(I.rsScroll.scrollTop=e,s=!0)}N&&clearInterval(d),is.number(t)&&(h.listTypeChoose=t,N=!0),e>I.rsScroll.scrollHeight-c&&(e=I.rsScroll.scrollHeight-c),e<=0&&(e=0),1e3<u&&(3<(r=function _quickIntervalNum(e){var t,n=1;for(t=0;t<6;t++)if(e<(n*=10)){n=t;break}return n}(u))?a=1.5-u/1e4*.1:2<r&&(a-=u/1e3*.1)),!is.IE()||is.IE()>E?(d=setInterval(function(){_calulate()},50),_calulate()):(I.rsScroll.scrollTop=e,setTimeout(function(){N=!1}))}(I.allTitle[e].offsetTop+I.rsList.offsetTop-I.rsScroll.offsetTop,e)},onListTypeOperate:function(e){var t=Number((I.quickNavTypeList.style.marginTop||"0px").replace(c,""));_scrollToLocation("prev"===e?t+3*g:t-3*g)},onShowSearch:function(e){h.exitAllNet&&(S&&(h.searchTypeShow=is.bool(e)?e:!h.searchTypeShow),m=S=!0)},onShowCircuitBox:function(e,t,n){var o,i,r;e&&(n&&(n.isShowTips=!1),i=(o=v.indexOf(e.target))<0?v.length:o,!1!==t?(o<0&&v.push(e.target),is.number(v.currIndex)&&i!==v.currIndex&&(b.getNextElement(v[v.currIndex]).style.display="none",b.getNextElement(v[v.currIndex]).parentNode.style.zIndex=""),v[i].bubble=!0,v.currIndex=i,"none"===((r=b.getNextElement(e.target)).style.display||"none")?(r.style.display="block",r.parentNode.style.zIndex="5"):r.style.display="none"):is.number(v.currIndex)&&(v[v.currIndex].bubble=!0))},onSearchTypeChoose:function(e){0===e?h.searchDefaultChoose=0:(h.searchDefaultChoose=1,h.rsSearchVal="",I.searchRsInput.value="",_searchRs()),h.searchTypeShow=!0,S=!1},onUnfoldNotice:function(e){!function _noticeFold(){var e=!0,t=tr("展开");I.noticeDetail.fold||(e=!1,t=tr("收起")),h.noticeUnfold=e,h.noticeBtnText=t,I.noticeDetail.fold=!e}()},onAllNetSearch:function(){h.$searchAllNetKey&&_toRsLocation()},onRsSearch:function(){_searchRs()},onCutOrPasteRs:function(e){setTimeout(function(){h.onSearchForm(e)},100)},onSearchForm:function(e){var t;t=(e=e||window.event).target||e.srcElement,e&&is.set(t.value)&&(h.searchDefaultChoose?h.$searchAllNetKey=t.value:h.rsSearchVal!==t.value&&(setTimeout(function(){SFCommon.debounce(_searchRs,500)()}),h.rsSearchVal=t.value),13===e.keyCode&&h.searchDefaultChoose&&_toRsLocation())},onSearchAllNet:function(e){var t;t=(e=e||window.event).target||e.srcElement,13===e.keyCode&&t.value&&(h.$searchAllNetKey=t.value,_toRsLocation())},onRsSearchFocus:function(e,t){var n;h.rsSearchFocusStatus=t,n=(e=e||window.event).target||e.srcElement,h.rsSearchVal!==n.value&&(h.rsSearchVal=n.value,_searchRs())},onAllNetSearchFocus:function(e,t){var n;n=(e=e||window.event).target||e.srcElement,h.$searchAllNetKey=n.value,n.value&&(t=!0),h.rsAllNetSearchFocusStatus=t},searchHintClick:function(){h.rsSearchFocusStatus=!0,I.searchRsInput.focus()},onAllNetHintClick:function(e,t){h.rsAllNetSearchFocusStatus=t,I.searchAllNetInput.focus()},onClearRsSearch:function(e){h.rsSearchVal="",b.getPrevElement(e.target||e.srcElement).value="",_searchRs()},onLoadBalancing:function(e,t){var n,o;A.isExistEC&&e&&h.ecIsExist&&(n=b.getPrevElement(e.target||e.srcElement).children[2],o=n.innerText,t.state&&!n.isLoading&&(n.innerText=tr("正在载入新的IP地址..."),n.isLoading=!0,SF.res.updateBalanceRes({name:t.name,rc_grp_id:t.rc_grp_id,selectid:t.selectid,id:t.id,success:function(e){var t;is.object(e)&&(t=e.data,modifyBalanceData(h.rslistData,t.BalancerUpdateRc),t.BalancerUpdateRc&&t.BalancerUpdateRc.Rc?n.innerText=t.BalancerUpdateRc.Rc.host:n.innerText=o,n.isLoading=!1)},error:function(e){n.innerText=o,n.isLoading=!1,D.error(C,"unexpected responsed data","cannot get babanlce message from "+JSON.stringify(e))}})))},rsOpen:function(n,o){if(O||"loading"!==n.curState)if(!1!==n.state){if(h.currClickRsId=n.id,y=!0,/^webapp:https?$/i.test(n.svc)&&SFCommon.isWeb()&&!(is.edge()||is.phone()||is.ie(">7")||is.chrome(">=48")||is.firefox(">=44")||is.safari(">=9")))return SF.setting.setGlobal({key:KEY_GLOBAL_BROWSER_CACHE,value:{id:n.id,index:o}},!1),void(window.location.href="/portal/#!/resource_browser_unsupport");i.loader.renderPlugin({name:PORTAL_MAP["other/common_loading"],data:{isDialog:!1,tips:tr("打开资源中"),beforeShow:function(){return new Promise(function(e,t){setTimeout(function(){e()},500)})},task:function(){return new Promise(function(t,e){_.handleResource(n.id,o).then(function(e){n.isShowTips=!1===e&&n.msg,setTimeout(function(){t()},400)})["catch"](function(){e()})})}},success:function(){D.debug(C,"render loading of open resource success, show loading")}})}else SFLOG.info(C,"resource ready disabled");else SFCommon.tips({msg:tr("正在启动服务，请稍候"),type:"error"})},onCancelMsgBabble:function(e,t){e.isShowTips=!1,t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,y=!0},onShowDownClick:function(){i.loader.renderPlugin({name:PORTAL_MAP["other/install"],data:{message:"",isAutoClose:!0,enableClose:!0}})},onShowSetting:function(e){h.isNotInitFinish=!SF.setting.getGlobal(KEY_GLOBAL_PERSON_SETTING_ID,"")&&!R,is.bool(e)||(e=!h.settingListShow),h.settingListShow=e},onGoSetting:function(){var e={};if(h.isNotInitFinish=!SF.setting.getGlobal(KEY_GLOBAL_PERSON_SETTING_ID,"")&&!R,R)h.pwdOverdueHint&&(e={from:"service",callback:function(){h.pwdOverdueHint=""}}),i.loader.renderPlugin({name:PORTAL_MAP["other/user_setting"],data:e});else{if(h.isNotInitFinish)return;SF.windowMgr.triggerEvent("onOpenPersonSetting","{}")}h.settingListShow=!1},onShowLogout:function(){i.loader.renderPlugin({name:PORTAL_MAP["other/islogout"]})},onUpdatePwd:function(){r&&clearTimeout(r.timer),i.loader.renderPlugin({name:PORTAL_MAP["views/user_setting_password"],data:{from:"service",callback:function(){h.pwdOverdueHint=""}}})},winMaximize:function(e){e?window.ecResize(0,o.maxWidth,o.maxHeight):window.ecResize(0,o.minWidth,o.minHeight)},onMaxOrRestore:function(){SF.windowMgr.maximize()},onShowGroupList:function(e){h.listTypeChoose=e}}},t.vmodel=avalon.define(t.getVModelConfig()),t});